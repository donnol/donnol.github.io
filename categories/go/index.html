<!doctype html><html lang=en dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://donnol.github.io/categories/go/"><meta property="og:site_name" content="我的简单博客"><meta property="og:title" content="Go"><meta property="og:locale" content="en"><meta property="og:type" content="website"><title>Go | 我的简单博客</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.95d69eb6bad8b9707ff2b5d8d9e31ce70a1b84f2ed7ffaf665ffcf00aa7993bd.css integrity="sha256-ldaetrrYuXB/8rXY2eMc5wobhPLtf/r2Zf/PAKp5k70=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.750fe54c7e0b7eee331c4b89486ce4d49e71fb5637d5208e2a3df7386f8a6d44.js integrity="sha256-dQ/lTH4Lfu4zHEuJSGzk1J5x+1Y31SCOKj33OG+KbUQ=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PNRWGCH4KN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PNRWGCH4KN")}</script><link rel=alternate type=application/rss+xml href=https://donnol.github.io/categories/go/index.xml title=我的简单博客></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>我的简单博客</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-88902446d608163b7be46632cb6bef72 class=toggle>
<label for=section-88902446d608163b7be46632cb6bef72 class="flex justify-between"><a role=button>2023</a></label><ul><li><input type=checkbox id=section-67c01fa78e6544e45d86cfb839555dd3 class=toggle>
<label for=section-67c01fa78e6544e45d86cfb839555dd3 class="flex justify-between"><a role=button>12</a></label><ul><li><a href=https://donnol.github.io/posts/2023/12/dbeaver%E6%89%8B%E5%8A%A8%E5%AF%BC%E5%85%A5%E9%A9%B1%E5%8A%A8/>dbeaver手动导入驱动</a></li><li><a href=https://donnol.github.io/posts/2023/12/do/>Do</a></li><li><a href=https://donnol.github.io/posts/2023/12/%E5%8F%8C%E6%A0%87/>双标</a></li><li><a href=https://donnol.github.io/posts/2023/12/%E5%8F%96%E4%B8%8E%E4%BA%A4/>取与交</a></li><li><a href=https://donnol.github.io/posts/2023/12/%E6%83%85%E6%99%AF/>情景</a></li><li><a href=https://donnol.github.io/posts/2023/12/%E6%9A%96%E5%BA%8A%E5%92%8C%E6%B3%A1%E6%B5%B4%E7%BC%B8/>暖床和泡浴缸</a></li><li><a href=https://donnol.github.io/posts/2023/12/%E6%9C%AA%E6%9D%A5/>未来</a></li><li><a href=https://donnol.github.io/posts/2023/12/%E8%A7%84%E7%9F%A9%E7%9A%84%E8%AE%A2%E7%AB%8B%E5%92%8C%E6%89%A7%E8%A1%8C/>规矩的订立和执行</a></li><li><a href=https://donnol.github.io/posts/2023/12/%E9%A9%B1%E8%99%8E%E5%90%9E%E7%8B%BC/>驱虎吞狼</a></li></ul></li><li><input type=checkbox id=section-e5e00708106809cefc1b0939618449f5 class=toggle>
<label for=section-e5e00708106809cefc1b0939618449f5 class="flex justify-between"><a role=button>10</a></label><ul><li><a href=https://donnol.github.io/posts/2023/10/mysql_count_distinct_with_over/>Mysql 8.0.33在使用窗口函数的同时不能用count(distinct *)</a></li><li><a href=https://donnol.github.io/posts/2023/10/wezterm/>Wezterm极简配置文件</a></li></ul></li><li><input type=checkbox id=section-e4a622c43fd57d7fdaea4a2f7de49a8d class=toggle>
<label for=section-e4a622c43fd57d7fdaea4a2f7de49a8d class="flex justify-between"><a role=button>09</a></label><ul><li><a href=https://donnol.github.io/posts/2023/09/%E9%9B%AA%E8%8A%B1id-%E6%97%B6%E9%92%9F%E5%9B%9E%E9%80%80%E9%97%AE%E9%A2%98/>雪花id的时钟回退问题</a></li><li><a href=https://donnol.github.io/posts/2023/09/go_escape_analysis/>Go escape analysis</a></li><li><a href=https://donnol.github.io/posts/2023/09/do/>What are you preparing to do?</a></li><li><a href=https://donnol.github.io/posts/2023/09/mysql/>查找并杀掉运行中事务</a></li><li><a href=https://donnol.github.io/posts/2023/09/goenv/>Vscode go cannot find GOROOT directory</a></li><li><a href=https://donnol.github.io/posts/2023/09/%E7%B3%BB%E7%BB%9F%E9%97%B4%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E4%BA%A4%E4%BA%92%E4%BB%A5%E5%AE%8C%E6%88%90%E4%BA%8B%E5%8A%A1/>不同系统之间通过网络对接</a></li><li><a href=https://donnol.github.io/posts/2023/09/your_life/>do</a></li><li><a href=https://donnol.github.io/posts/2023/09/go_empty_struct/>Go Empty Struct</a></li><li><a href=https://donnol.github.io/posts/2023/09/%E4%B8%BA%E4%BA%86%E4%BB%96%E6%98%AF%E8%87%AA%E5%B7%B1%E8%BD%AF%E5%BC%B1%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%9F%E5%8F%A3/>为了他是自己软弱的最大借口</a></li></ul></li><li><input type=checkbox id=section-8838f5d25b6f603e7c063d350b35a0d5 class=toggle>
<label for=section-8838f5d25b6f603e7c063d350b35a0d5 class="flex justify-between"><a role=button>07</a></label><ul><li><a href=https://donnol.github.io/posts/2023/07/jupyter/>Jupyter notebook</a></li><li><a href=https://donnol.github.io/posts/2023/07/vscode_traslate/>Vscode Translate</a></li><li><a href=https://donnol.github.io/posts/2023/07/windows_restart_remote_service/>Windows restart remote service</a></li><li><a href=https://donnol.github.io/posts/2023/07/error/>错误的定义和返回</a></li><li><a href=https://donnol.github.io/posts/2023/07/prometheus/>Prometheus start failed</a></li><li><a href=https://donnol.github.io/posts/2023/07/compare_order/>Compare and Order</a></li></ul></li><li><input type=checkbox id=section-74cf2507fef5fa65009db6bf308e9a1f class=toggle>
<label for=section-74cf2507fef5fa65009db6bf308e9a1f class="flex justify-between"><a role=button>06</a></label><ul><li><a href=https://donnol.github.io/posts/2023/06/sklearn/>ml sklearn</a></li><li><a href=https://donnol.github.io/posts/2023/06/route/>windows route</a></li><li><a href=https://donnol.github.io/posts/2023/06/wsl2/>wsl2初始化Mysql数据库速度非常慢</a></li></ul></li><li><input type=checkbox id=section-527b55105d8d0045f9ee6dadd1e05e12 class=toggle>
<label for=section-527b55105d8d0045f9ee6dadd1e05e12 class="flex justify-between"><a role=button>05</a></label><ul><li><a href=https://donnol.github.io/posts/2023/05/flutter_widget_element/>flutter Widget Element</a></li><li><a href=https://donnol.github.io/posts/2023/05/mysqlrouter/>mysqlrouter使用</a></li></ul></li><li><input type=checkbox id=section-ecc435df562a851b07184b1c1c4240b1 class=toggle>
<label for=section-ecc435df562a851b07184b1c1c4240b1 class="flex justify-between"><a role=button>04</a></label><ul><li><a href=https://donnol.github.io/posts/2023/04/nats/>NATS</a></li></ul></li><li><input type=checkbox id=section-375d37ccc725e9745ac2faf03a4499c2 class=toggle>
<label for=section-375d37ccc725e9745ac2faf03a4499c2 class="flex justify-between"><a role=button>01</a></label><ul><li><a href=https://donnol.github.io/posts/2023/01/go_generic_join/>Go Generic Join</a></li></ul></li><li><a href=https://donnol.github.io/posts/2023/11/go_template_dot/>Go Template Dot</a></li><li><a href=https://donnol.github.io/posts/2023/11/lllj/>Lllj</a></li><li><a href=https://donnol.github.io/posts/2023/11/%E4%B9%B0%E8%B5%8C%E6%8A%A2/>买赌抢</a></li><li><a href=https://donnol.github.io/posts/2023/11/%E5%90%91%E5%BE%80/>向往</a></li><li><a href=https://donnol.github.io/posts/2023/11/%E5%B1%95%E5%BC%80%E5%AE%8F%E4%BB%A5%E6%96%B9%E4%BE%BF%E9%98%85%E8%AF%BB/>展开宏以方便阅读</a></li><li><a href=https://donnol.github.io/posts/2023/11/%E7%90%86%E6%83%B3%E5%92%8C%E7%8E%B0%E5%AE%9E/>理想和现实</a></li></ul></li><li><input type=checkbox id=section-13b23314291792827d52ebbe811ebe4a class=toggle>
<label for=section-13b23314291792827d52ebbe811ebe4a class="flex justify-between"><a role=button>2022</a></label><ul><li><input type=checkbox id=section-be392bde2f802f04206051ce2326765b class=toggle>
<label for=section-be392bde2f802f04206051ce2326765b class="flex justify-between"><a role=button>12</a></label><ul></ul></li><li><input type=checkbox id=section-f87081d5433be20cb5c4724887670142 class=toggle>
<label for=section-f87081d5433be20cb5c4724887670142 class="flex justify-between"><a role=button>07</a></label><ul><li><a href=https://donnol.github.io/posts/2022/07/jump_table/>Jump Table</a></li><li><a href=https://donnol.github.io/posts/2022/07/number_calculate/>数字计算之分摊</a></li></ul></li><li><input type=checkbox id=section-be370e43a73b6a039cfd945ef9aa4dc7 class=toggle>
<label for=section-be370e43a73b6a039cfd945ef9aa4dc7 class="flex justify-between"><a role=button>05</a></label><ul><li><a href=https://donnol.github.io/posts/2022/05/generic/>泛型</a></li><li><a href=https://donnol.github.io/posts/2022/05/find_go_version_the_app_use/>Find out which Go version built your binary</a></li><li><a href=https://donnol.github.io/posts/2022/05/k8s_how_to_keep_pods/>k8s是怎么维持pod的运行的呢？</a></li><li><a href=https://donnol.github.io/posts/2022/05/go_enum/>Go enum</a></li></ul></li><li><input type=checkbox id=section-720d031152cdf3e533a2139eaa53eee6 class=toggle>
<label for=section-720d031152cdf3e533a2139eaa53eee6 class="flex justify-between"><a role=button>04</a></label><ul><li><a href=https://donnol.github.io/posts/2022/04/go1.18_comparable/>Go1.18 comparable</a></li></ul></li><li><input type=checkbox id=section-c034cabf3b8ad9fabf033690218e8ba2 class=toggle>
<label for=section-c034cabf3b8ad9fabf033690218e8ba2 class="flex justify-between"><a role=button>03</a></label><ul><li><a href=https://donnol.github.io/posts/2022/03/kmp/>KMP</a></li></ul></li><li><input type=checkbox id=section-21e005e3e03cd46d8214a804982b395b class=toggle>
<label for=section-21e005e3e03cd46d8214a804982b395b class="flex justify-between"><a role=button>02</a></label><ul><li><a href=https://donnol.github.io/posts/2022/02/%E9%9C%9C%E4%B9%8B%E5%93%80%E4%BC%A4/>霜之哀伤</a></li><li><a href=https://donnol.github.io/posts/2022/02/goroutine_vs_tokio/>goroutine vs tokio</a></li><li><a href=https://donnol.github.io/posts/2022/02/go_runtime_chan/>go runtime chan</a></li><li><a href=https://donnol.github.io/posts/2022/02/go_work/>go work</a></li><li><a href=https://donnol.github.io/posts/2022/02/distractions/>杂念</a></li></ul></li><li><input type=checkbox id=section-d12dcecc5bcd75c28d94c5b26097c574 class=toggle>
<label for=section-d12dcecc5bcd75c28d94c5b26097c574 class="flex justify-between"><a role=button>01</a></label><ul><li><a href=https://donnol.github.io/posts/2022/01/rust_safe/>Rust与安全</a></li><li><a href=https://donnol.github.io/posts/2022/01/wasmtime/>wasm运行时wasmtime</a></li><li><a href=https://donnol.github.io/posts/2022/01/container_encrypt/>容器镜像加密</a></li><li><a href=https://donnol.github.io/posts/2022/01/smart_contract/>智能合约</a></li><li><a href=https://donnol.github.io/posts/2022/01/learn_go_fast/>Go快速入门</a></li><li><a href=https://donnol.github.io/posts/2022/01/consensus/>consensus</a></li><li><a href=https://donnol.github.io/posts/2022/01/red_black_tree/>红黑树</a></li><li><a href=https://donnol.github.io/posts/2022/01/rust_commonly_used_crate/>Rust常用库</a></li><li><a href=https://donnol.github.io/posts/2022/01/cache/>缓存和数据库如何保持一致</a></li></ul></li></ul></li><li><input type=checkbox id=section-84bbf3dbf9679fbd75c1a04dbc15ba53 class=toggle>
<label for=section-84bbf3dbf9679fbd75c1a04dbc15ba53 class="flex justify-between"><a role=button>2021</a></label><ul><li><input type=checkbox id=section-906860f41f3d13df51bdd75562b6a53b class=toggle>
<label for=section-906860f41f3d13df51bdd75562b6a53b class="flex justify-between"><a role=button>12</a></label><ul><li><a href=https://donnol.github.io/posts/2021/12/ebpf/>ebpf</a></li><li><a href=https://donnol.github.io/posts/2021/12/time_wenzi/>时间和文字</a></li><li><a href=https://donnol.github.io/posts/2021/12/etcd/>etcd</a></li><li><a href=https://donnol.github.io/posts/2021/12/vscode-go-module/>vscode-go在go.mod在非根目录情况下失效的问题</a></li><li><a href=https://donnol.github.io/posts/2021/12/mqtt/>mqtt</a></li><li><a href=https://donnol.github.io/posts/2021/12/redis_sds/>redis sds</a></li><li><a href=https://donnol.github.io/posts/2021/12/k8s/>k8s</a></li><li><a href=https://donnol.github.io/posts/2021/12/ddia/>数据密集型应用设计</a></li><li><a href=https://donnol.github.io/posts/2021/12/burn_cpu_use_golang/>burn cpu use golang</a></li><li><a href=https://donnol.github.io/posts/2021/12/docker_compose_extra_host/>docker compose使用extra host让容器访问主机服务</a></li><li><a href=https://donnol.github.io/posts/2021/12/dbeaver/>数据库管理工具之dbeaver</a></li><li><a href=https://donnol.github.io/posts/2021/12/domain/>Domain-oriented development</a></li><li><a href=https://donnol.github.io/posts/2021/12/github_action_deploy_hugo_blog/>github action deploy hugo blog</a></li></ul></li><li><input type=checkbox id=section-17888aa71e14aa5ca2f4ffd47d1fbfe8 class=toggle>
<label for=section-17888aa71e14aa5ca2f4ffd47d1fbfe8 class="flex justify-between"><a role=button>07</a></label><ul><li><a href=https://donnol.github.io/posts/2021/07/linux-epoll/>linux epoll</a></li></ul></li><li><input type=checkbox id=section-97f1c934fce2a072bd4fb42288e67e01 class=toggle>
<label for=section-97f1c934fce2a072bd4fb42288e67e01 class="flex justify-between"><a role=button>01</a></label><ul><li><a href=https://donnol.github.io/posts/2021/01/proxy-between-layer/>Go实现AOP</a></li><li><a href=https://donnol.github.io/posts/2021/01/hugo-blog/>hugo搭建博客</a></li><li><a href=https://donnol.github.io/posts/2021/01/pstree/>pstree进程树及说明</a></li></ul></li></ul></li><li><input type=checkbox id=section-a40a6177600e1c6c6b80c2b7d293a317 class=toggle>
<label for=section-a40a6177600e1c6c6b80c2b7d293a317 class="flex justify-between"><a role=button>2020</a></label><ul><li><input type=checkbox id=section-b4bf87527d09276d38daa8e83ff01c07 class=toggle>
<label for=section-b4bf87527d09276d38daa8e83ff01c07 class="flex justify-between"><a role=button>12</a></label><ul><li><a href=https://donnol.github.io/posts/2020/12/go-ctx/>go ctx</a></li></ul></li></ul></li><li><input type=checkbox id=section-df6734adf28db90f3c5a7bda1b865da2 class=toggle>
<label for=section-df6734adf28db90f3c5a7bda1b865da2 class="flex justify-between"><a role=button>2024</a></label><ul><li><a href=https://donnol.github.io/posts/2024/01/gopls-hightlight-template/>Gopls Hightlight Template</a></li><li><a href=https://donnol.github.io/posts/2024/01/vscode%E9%80%89%E4%B8%AD%E6%89%80%E6%9C%89%E5%8C%B9%E9%85%8D%E9%A1%B9/>Vscode选中所有匹配项</a></li><li><a href=https://donnol.github.io/posts/2024/01/wsl2_config/>Wsl2 Config</a></li><li><a href=https://donnol.github.io/posts/2024/01/%E5%88%BA%E7%A0%B4/>刺破</a></li><li><a href=https://donnol.github.io/posts/2024/01/%E5%A5%BD%E5%9D%8F/>好坏</a></li><li><a href=https://donnol.github.io/posts/2024/01/%E6%A8%A1%E5%9D%97%E5%8C%96%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%8C%96/>模块化和服务化</a></li><li><a href=https://donnol.github.io/posts/2024/01/%E7%AE%97%E6%95%B0/>算数</a></li><li><a href=https://donnol.github.io/posts/2024/01/%E8%BD%AC%E5%90%91/>转向</a></li><li><a href=https://donnol.github.io/posts/2024/01/%E8%BD%AF%E5%BC%B1/>软弱</a></li><li><a href=https://donnol.github.io/posts/2024/02/%E5%A8%81%E6%9C%9B/>威望</a></li><li><a href=https://donnol.github.io/posts/2024/02/%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88/>排列组合</a></li><li><a href=https://donnol.github.io/posts/2024/02/%E7%89%A9%E6%9E%81%E5%BF%85%E5%8F%8D/>物极必反</a></li><li><a href=https://donnol.github.io/posts/2024/03/3.10/>3.10</a></li><li><a href=https://donnol.github.io/posts/2024/03/ffmpeg/>Ffmpeg</a></li><li><a href=https://donnol.github.io/posts/2024/03/match/>Match</a></li><li><a href=https://donnol.github.io/posts/2024/03/%E4%B8%83%E6%97%A5/>七日</a></li><li><a href=https://donnol.github.io/posts/2024/03/%E4%B8%AD%E5%86%9B%E4%B9%8B%E5%BF%97/>中军之志</a></li><li><a href=https://donnol.github.io/posts/2024/03/%E5%85%B1%E6%80%A7%E5%92%8C%E4%B8%AA%E6%80%A7/>共性和个性</a></li><li><a href=https://donnol.github.io/posts/2024/03/%E5%89%A5%E5%89%8A%E7%9A%84%E4%B8%A4%E6%9E%81/>剥削的两极</a></li><li><a href=https://donnol.github.io/posts/2024/03/%E6%8B%B3/>拳</a></li><li><a href=https://donnol.github.io/posts/2024/03/%E6%97%A2/>既</a></li><li><a href=https://donnol.github.io/posts/2024/03/%E8%8B%B1%E9%9B%84%E5%B0%8F%E5%85%B5/>英雄小兵</a></li><li><a href=https://donnol.github.io/posts/2024/03/%E8%B6%85%E8%B5%B6/>超赶</a></li><li><a href=https://donnol.github.io/posts/2024/04/oneline/>Oneline</a></li><li><a href=https://donnol.github.io/posts/2024/04/procfile/>Procfile</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E4%BA%B2%E7%96%8F%E4%B9%8B%E5%88%AB/>亲疏之别</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/>动态规划</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E5%A5%BD%E6%97%B6%E4%BB%A3/>好时代</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E5%B0%B1/>就</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E5%BB%BA%E8%AE%BE%E8%BF%98%E6%98%AF%E7%A0%B4%E5%9D%8F/>建设还是破坏</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E6%94%B6%E5%85%A5/>收入</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E6%97%A0%E7%A9%B7/>无穷</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E6%97%B6%E7%A9%BA%E4%BA%BA%E7%89%A9%E4%BA%8B/>时空人物事</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E6%B6%88%E9%81%A3/>消遣</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E6%BB%A1%E8%B6%B3/>满足</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E7%86%AC%E5%A4%9C%E6%89%93%E6%B8%B8%E6%88%8F/>熬夜打游戏</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E7%9F%A5%E8%AF%86-%E9%BB%84%E9%87%91-%E6%AD%A6%E5%99%A8/>知识 黄金 武器</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E7%A4%BE%E4%BC%9A/>社会</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E7%A8%B3/>稳</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E7%A9%BA%E9%A5%B7/>空饷</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E7%AE%A1%E7%90%86/>管理</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E7%BC%96%E5%AF%BC%E6%BC%94/>编导演</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E8%87%AA%E6%88%91%E8%B4%AC%E4%BD%8E/>自我贬低</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E8%8C%A7%E6%88%BF/>茧房</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E8%8E%BD%E7%AD%89%E5%86%B2/>莽等冲</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E8%AE%A4%E7%88%B6%E5%B0%81%E7%A5%9E/>认父封神</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E9%94%99%E8%AF%AF%E6%81%A2%E5%A4%8D-%E4%BA%89%E6%89%A7%E6%81%A2%E5%A4%8D/>错误恢复 争执恢复</a></li><li><a href=https://donnol.github.io/posts/2024/04/%E9%9A%8F%E7%BC%98/>随缘</a></li><li><a href=https://donnol.github.io/posts/2024/05/go-iter/>Go Iter</a></li><li><a href=https://donnol.github.io/posts/2024/05/%E5%8D%B7%E7%A7%AF/>卷积</a></li><li><a href=https://donnol.github.io/posts/2024/05/%E5%BC%BA%E5%BA%A6/>强度</a></li><li><a href=https://donnol.github.io/posts/2024/05/%E6%81%A9%E5%A8%81/>恩威</a></li><li><a href=https://donnol.github.io/posts/2024/05/%E6%9D%83%E5%88%A9/>权利</a></li><li><a href=https://donnol.github.io/posts/2024/05/%E6%B1%82%E5%AE%9E%E5%8A%A1%E8%99%9A/>求实务虚</a></li><li><a href=https://donnol.github.io/posts/2024/05/%E6%BC%A0%E8%A7%86/>漠视</a></li><li><a href=https://donnol.github.io/posts/2024/05/%E7%9F%9B%E7%9B%BE/>矛盾</a></li><li><a href=https://donnol.github.io/posts/2024/05/%E7%AE%80%E5%8C%96/>简化</a></li><li><a href=https://donnol.github.io/posts/2024/05/%E7%BB%9F%E6%B2%BB/>统治</a></li><li><a href=https://donnol.github.io/posts/2024/05/%E8%A1%8C/>行</a></li><li><a href=https://donnol.github.io/posts/2024/05/%E9%99%B7%E9%98%B1/>陷阱</a></li><li><a href=https://donnol.github.io/posts/2024/06/vscode-go-version/>Vscode Go Version</a></li><li><a href=https://donnol.github.io/posts/2024/06/%E5%B7%A5%E5%8E%82%E5%92%8C%E4%BD%9C%E5%9D%8A/>工厂和作坊</a></li><li><a href=https://donnol.github.io/posts/2024/06/%E5%BC%AF%E9%81%93%E8%B6%85%E8%BD%A6%E5%92%8C%E4%BC%BA%E6%9C%BA%E8%B6%85%E8%B6%8A/>弯道超车和伺机超越</a></li><li><a href=https://donnol.github.io/posts/2024/06/%E6%8E%A5%E5%8F%A3%E6%8A%BD%E8%B1%A1-%E5%AE%9E%E7%8E%B0%E5%88%86%E5%9D%97/>接口抽象 实现分块</a></li><li><a href=https://donnol.github.io/posts/2024/06/%E6%95%B0%E6%8D%AE%E5%92%8C%E7%BD%91%E7%BB%9C/>数据和网络</a></li><li><a href=https://donnol.github.io/posts/2024/06/%E6%9C%BA%E5%88%B6%E5%92%8C%E7%AD%96%E7%95%A5/>机制和策略</a></li><li><a href=https://donnol.github.io/posts/2024/06/%E6%9D%83%E8%B4%A3/>权责</a></li><li><a href=https://donnol.github.io/posts/2024/06/%E6%B0%B4%E5%9C%9F%E4%B8%8E%E4%BA%BA/>水土与人</a></li><li><a href=https://donnol.github.io/posts/2024/06/%E8%87%B4%E6%95%AC%E5%92%8C%E8%BF%BD%E9%9A%8F/>致敬和追随</a></li><li><a href=https://donnol.github.io/posts/2024/07/%E4%B8%93%E5%88%B6%E5%92%8C%E7%A7%91%E5%AD%A6/>专制和科学</a></li><li><a href=https://donnol.github.io/posts/2024/07/%E5%80%BC%E4%B8%8E%E4%B8%8D%E5%80%BC/>值与不值</a></li><li><a href=https://donnol.github.io/posts/2024/07/%E5%AE%9E%E4%BA%8B%E6%B1%82%E6%98%AF%E5%92%8C%E5%AF%BB%E6%A0%B9%E9%97%AE%E5%BA%95/>实事求是和寻根问底</a></li><li><a href=https://donnol.github.io/posts/2024/07/%E7%94%B3%E8%AF%B7%E4%BD%BF%E7%94%A8%E6%B8%85%E6%B4%97%E9%87%8A%E6%94%BE/>申请使用清洗释放</a></li><li><a href=https://donnol.github.io/posts/2024/08/go-error-check/>Go Error Check</a></li><li><a href=https://donnol.github.io/posts/2024/08/%E5%8D%8A%E7%9C%9F%E5%8D%8A%E5%81%87/>半真半假</a></li><li><a href=https://donnol.github.io/posts/2024/08/%E5%9B%BD%E5%AE%B6%E4%BC%9A%E5%87%BA%E6%89%8B/>国家会出手</a></li><li><a href=https://donnol.github.io/posts/2024/08/%E5%A5%89%E7%8C%AE%E7%89%BA%E7%89%B2%E5%BF%8D%E8%80%90%E4%BB%A3%E4%BB%B7/>奉献牺牲忍耐代价</a></li><li><a href=https://donnol.github.io/posts/2024/08/%E6%A8%A1%E5%9D%97%E5%8C%96-%E4%BE%9D%E8%B5%96/>模块化 依赖</a></li><li><a href=https://donnol.github.io/posts/2024/08/%E7%8E%AF%E5%A2%83%E4%B8%8E%E4%BA%BA%E7%89%A9/>环境与人物</a></li><li><a href=https://donnol.github.io/posts/2024/08/%E8%AE%BE%E8%AE%A1%E5%92%8C%E6%89%A7%E8%A1%8C/>设计和执行</a></li><li><a href=https://donnol.github.io/posts/2024/09/%E5%8F%8D%E9%A6%88/>反馈</a></li><li><a href=https://donnol.github.io/posts/2024/09/%E5%A4%A7%E5%93%A5%E7%AB%99%E5%87%BA%E6%9D%A5/>大哥站出来</a></li><li><a href=https://donnol.github.io/posts/2024/09/%E6%8E%A8%E6%BC%94/>推演</a></li><li><a href=https://donnol.github.io/posts/2024/09/%E7%89%B9%E6%9D%83%E6%91%A7%E6%AF%81%E8%A7%84%E7%9F%A9/>特权摧毁规矩</a></li><li><a href=https://donnol.github.io/posts/2024/09/%E8%83%B8%E8%A5%9F/>胸襟</a></li><li><a href=https://donnol.github.io/posts/2024/09/%E8%87%AA%E7%84%B6%E8%A7%84%E5%BE%8B%E5%92%8C%E5%B8%82%E5%9C%BA%E8%A7%84%E5%BE%8B/>自然规律和市场规律</a></li></ul></li><li><a href=https://donnol.github.io/posts/aboutme/about-me/>关于我</a></li></ul><ul><li><a href=https://github.com/donnol/blog target=_blank rel=noopener>Github</a></li><li><a href=https://themes.gohugo.io/hugo-book/ target=_blank rel=noopener>Hugo Themes</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Go</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav><ul><li class=book-section-flat><strong>Categories</strong><ul><li class="flex justify-between"><a href=/categories/db/>DB</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/mysql-8/>Mysql 8</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/rust/>Rust</a>
<span>3</span></li><li class="flex justify-between"><a href=/categories/wezterm/>Wezterm</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/snowflake/>Snowflake</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/time/>Time</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/do/>Do</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/escape-analysis/>Escape Analysis</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/go/>Go</a>
<span>17</span></li><li class="flex justify-between"><a href=/categories/mysql/>Mysql</a>
<span>3</span></li><li class="flex justify-between"><a href=/categories/vscode/>Vscode</a>
<span>3</span></li><li class="flex justify-between"><a href=/categories/windows/>Windows</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/prometheus/>Prometheus</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/compare/>Compare</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/order/>Order</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/sklearn/>Sklearn</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/route/>Route</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/wsl2/>Wsl2</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/element/>Element</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/flutter/>Flutter</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/widget/>Widget</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/router/>Router</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/nats/>NATS</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/generic/>Generic</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/join/>Join</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/number/>Number</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/structure/>Structure</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/typescript/>TypeScript</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/k8s/>K8s</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/algorithm/>Algorithm</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/kmp/>KMP</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/frostmourne/>Frostmourne</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/goroutine/>Goroutine</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/tokio/>Tokio</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/chan/>Chan</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/runtime/>Runtime</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/distractions/>Distractions</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/work/>Work</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/wasi/>Wasi</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/wasm/>Wasm</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/blockchain/>Blockchain</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/container/>Container</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/docker/>Docker</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/image/>Image</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/smart-contract/>Smart Contract</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/consensus/>Consensus</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/red-black-tree/>Red-Black-Tree</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/tree/>Tree</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/cache/>Cache</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/database/>Database</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/linux/>Linux</a>
<span>3</span></li><li class="flex justify-between"><a href=/categories/%E6%9D%82%E5%BF%B5/>杂念</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/etcd/>Etcd</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/vscode-go/>Vscode-Go</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/message-queue/>Message Queue</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/redis/>Redis</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/book/>Book</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/dbmanager/>Dbmanager</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/ddd/>Ddd</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/blog/>Blog</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/tools/>Tools</a>
<span>1</span></li></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/mark/>Mark</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/note/>Note</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/restart-remote-service/>Restart-Remote-Service</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/translate/>Translate</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/prometheus/>Prometheus</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/thought/>Thought</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ml/>Ml</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/route/>Route</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/mysql/>Mysql</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/flutter/>Flutter</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/mysqlrouter/>Mysqlrouter</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/nats/>NATS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/join/>Join</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/calculate/>Calculate</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/jump-table/>Jump Table</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/generic/>Generic</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/version/>Version</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/pod/>Pod</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/enum/>Enum</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/comparable/>Comparable</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/workspace/>Workspace</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/concurrent/>Concurrent</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/chan/>Chan</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/safe/>Safe</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/wasmtime/>Wasmtime</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/encrypt/>Encrypt</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/eth/>Eth</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/evm/>Evm</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/learn/>Learn</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/deal/>Deal</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/data-struct/>Data-Struct</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/crate/>Crate</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/redis/>Redis</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ebpf/>Ebpf</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/%E6%96%87%E5%AD%97/>文字</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/%E6%97%B6%E9%97%B4/>时间</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/gomod/>Gomod</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/raft/>Raft</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/mqtt/>Mqtt</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/sds/>Sds</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ddia/>Ddia</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/k8s/>K8s</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/compose/>Compose</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/cpu/>Cpu</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/dbeaver/>Dbeaver</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/domain/>Domain</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/deploy/>Deploy</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/epoll/>Epoll</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/aop/>Aop</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/hugo/>Hugo</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/proxy/>Proxy</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ctx/>Ctx</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/pstree/>Pstree</a>
<span>1</span></li></ul></li></ul></nav></aside></header><article class="markdown book-post"><h2><a href=/posts/2023/09/go_escape_analysis/>Go escape analysis</a></h2><h5>September 20, 2023</h5><div><a href=/categories/go/>Go</a>,
<a href=/categories/escape-analysis/>Escape Analysis</a></div><div><a href=/tags/note/>Note</a></div><p><blockquote><p>The meaning of <code>escapes to the heap</code> is variables needs to <code>be shared across the function stack frames</code> [between main() and Println()]
&mldr;</p><p>&mldr;
So <code>globally access variables</code> must be <code>moved to heap</code> as it requires runtime. So the output line 11:2 shows the same as the data variable moved to the heap memory.</p></blockquote><p><a href=https://mayurwadekar2.medium.com/escape-analysis-in-golang-ee40a1c064c1>From</a></p></p></article><article class="markdown book-post"><h2><a href=/posts/2023/09/goenv/>Vscode go cannot find GOROOT directory</a></h2><h5>September 13, 2023</h5><div><a href=/categories/go/>Go</a>,
<a href=/categories/vscode/>Vscode</a></div><div><a href=/tags/mark/>Mark</a></div><p><p>今天发现在windows上的vscode一直提示找不到go：<code>go: cannot find GOROOT directory: c:\msys64\mingw64\lib\go</code>。</p><p>强制设置了go.goroot也不行，直到查看了GOENV文件（C:\Users\xxx\AppData\Roaming\go\env）之后，才发现里面有一行：GOROOT=c:\msys64\mingw64\lib\go，可能是当时在msys2安装go的时候加上的。</p><p>去掉它就恢复正常了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ go env
</span></span><span style=display:flex><span>set GOENV<span style=color:#f92672>=</span>C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\x</span>xx<span style=color:#ae81ff>\A</span>ppData<span style=color:#ae81ff>\R</span>oaming<span style=color:#ae81ff>\g</span>o<span style=color:#ae81ff>\e</span>nv
</span></span><span style=display:flex><span>set GOHOSTARCH<span style=color:#f92672>=</span>amd64
</span></span><span style=display:flex><span>set GOHOSTOS<span style=color:#f92672>=</span>windows
</span></span><span style=display:flex><span>set GOMODCACHE<span style=color:#f92672>=</span>C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\x</span>xx<span style=color:#ae81ff>\g</span>o<span style=color:#ae81ff>\p</span>kg<span style=color:#ae81ff>\m</span>od
</span></span><span style=display:flex><span>set GOOS<span style=color:#f92672>=</span>windows
</span></span><span style=display:flex><span>set GOPATH<span style=color:#f92672>=</span>C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\x</span>xx<span style=color:#ae81ff>\g</span>o
</span></span><span style=display:flex><span>set GOPRIVATE<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>set GOPROXY<span style=color:#f92672>=</span>https://goproxy.cn,https://goproxy.io,direct
</span></span><span style=display:flex><span>set GOROOT<span style=color:#f92672>=</span>C:<span style=color:#ae81ff>\P</span>rogram Files<span style=color:#ae81ff>\G</span>o
</span></span></code></pre></div><p>应该是这样的，如果用<code>go env -w </code>来设置goroot，那么这个值就会保存到GOENV对应的文件里，如果是<code>$env:GOROOT=xxx</code>的方式来设置则不会修改GOENV文件里的内容。这时候，如果vscode是优先从GOENV文件来获取GOROOT的话，就可能会导致与实际的GOROOT不一致。</p><p>所以，如果再遇到以上错误，除了<code>echo $env:GOROOT</code> 看一下环境变量值之外，也要看一下<code>GOENV</code>文件。</p></p></article><article class="markdown book-post"><h2><a href=/posts/2023/09/%E7%B3%BB%E7%BB%9F%E9%97%B4%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E4%BA%A4%E4%BA%92%E4%BB%A5%E5%AE%8C%E6%88%90%E4%BA%8B%E5%8A%A1/>不同系统之间通过网络对接</a></h2><h5>September 13, 2023</h5><div><a href=/categories/go/>Go</a>,
<a href=/categories/vscode/>Vscode</a></div><div><a href=/tags/mark/>Mark</a></div><p><p>不同系统之间通过网络对接</p><h2 id=数据库事件>数据库事件
<a class=anchor href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e4%ba%8b%e4%bb%b6>#</a></h2><ol><li><p>可以用个<code>事件表</code>来做，在事务执行过程中添加<code>事件</code>(确保事务完成时事件也存在)。</p></li><li><p>在事务提交之后，先尝试做一次事件，如果成功了就把事件状态置为成功；如果失败了也没关系，另外开定时器来扫表进行<code>重试</code>执行。 &ndash; 此时不影响正常业务执行</p></li><li><p>在事件处理事务里的网络请求里加入超时控制，确保事件不会执行太久，导致接口过慢。</p></li><li><p>网络请求支持<code>幂等</code>，防止事件处理事务请求成功了，但是事务挂了导致状态未变更，这种情况下会重复请求多次。</p></li></ol><h3 id=skip-locked实现><code>skip locked</code>实现
<a class=anchor href=#skip-locked%e5%ae%9e%e7%8e%b0>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 条件字段必须有索引(status, [name, status])，排序字段必须是主键(id)，此时刚好是所要锁定的行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>start</span> <span style=color:#66d9ef>transaction</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- select * from w_event we where status in (1) order by create_time asc limit 1 for update skip locked; -- 引入create_time作为排序字段时，会将符合条件的行都锁住，`limit 1`不起作用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> w_event we <span style=color:#66d9ef>where</span> status <span style=color:#66d9ef>in</span> (<span style=color:#ae81ff>1</span>) <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> id <span style=color:#66d9ef>asc</span> <span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>update</span> skip locked; <span style=color:#75715e>-- 使用主键字段作排序时，`limit 1`则起作用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> w_event we <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;测试&#39;</span> <span style=color:#66d9ef>and</span> status <span style=color:#66d9ef>in</span> (<span style=color:#ae81ff>1</span>) <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> id <span style=color:#66d9ef>asc</span> <span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>update</span> skip locked; <span style=color:#75715e>-- 如果有多个字段作为条件，需要建立组合索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> object_name, index_name, lock_type, lock_mode, lock_data <span style=color:#66d9ef>FROM</span> performance_schema.data_locks; <span style=color:#75715e>-- 查看上锁情况
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> w_event we <span style=color:#66d9ef>where</span> status <span style=color:#66d9ef>in</span> (<span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> id <span style=color:#66d9ef>asc</span> <span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>update</span> skip locked;
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> w_event we <span style=color:#66d9ef>where</span> status <span style=color:#66d9ef>in</span> (<span style=color:#ae81ff>3</span>) <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> id <span style=color:#66d9ef>asc</span> <span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>update</span> skip locked;
</span></span><span style=display:flex><span><span style=color:#66d9ef>commit</span>;
</span></span></code></pre></div><p>可打开两个线程来验证上述事务执行，可以看到，当满足条件的记录有两条或以上时，当<code>事务1</code>查到<code>记录1</code>后，<code>事务1</code>未提交时，<code>事务2</code>不会拿到<code>记录1</code>，而是会拿到<code>记录2</code>. 也就实现了有锁则获取下一批数据的效果。</p><a href=/posts/2023/09/%E7%B3%BB%E7%BB%9F%E9%97%B4%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E4%BA%A4%E4%BA%92%E4%BB%A5%E5%AE%8C%E6%88%90%E4%BA%8B%E5%8A%A1/>...</a></p></article><article class="markdown book-post"><h2><a href=/posts/2023/09/go_empty_struct/>Go Empty Struct</a></h2><h5>September 1, 2023</h5><div><a href=/categories/go/>Go</a></div><div><a href=/tags/mark/>Mark</a></div><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;unsafe&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>A</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>B</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 结构体里的字段都是`Empty Struct`时，占用空间为0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>S</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>A</span> <span style=color:#a6e22e>A</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>B</span> <span style=color:#a6e22e>B</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s</span> <span style=color:#a6e22e>S</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>unsafe</span>.<span style=color:#a6e22e>Sizeof</span>(<span style=color:#a6e22e>s</span>)) <span style=color:#75715e>// prints 0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 如果是指针，占用空间为8
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>unsafe</span>.<span style=color:#a6e22e>Sizeof</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>s</span>)) <span style=color:#75715e>// prints 8
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> [<span style=color:#ae81ff>1000000000</span>]<span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 可以同时存储A和B类型元素
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>x</span>[<span style=color:#ae81ff>0</span>] = <span style=color:#a6e22e>A</span>{}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>x</span>[<span style=color:#ae81ff>1</span>] = <span style=color:#a6e22e>B</span>{}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>unsafe</span>.<span style=color:#a6e22e>Sizeof</span>(<span style=color:#a6e22e>x</span>)) <span style=color:#75715e>// prints 0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 地址一样
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%p, %p&#34;</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>x</span>[<span style=color:#ae81ff>0</span>], <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>x</span>[<span style=color:#ae81ff>1</span>]) <span style=color:#75715e>// 0x54e3a0, 0x54e3a0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p><a href=https://dave.cheney.net/2014/03/25/the-empty-struct>See also</a></p></p></article><article class="markdown book-post"><h2><a href=/posts/2023/04/nats/>NATS</a></h2><h5>April 24, 2023</h5><div><a href=/categories/go/>Go</a>,
<a href=/categories/nats/>NATS</a></div><div><a href=/tags/nats/>NATS</a></div><p><h2 id=是什么>是什么？
<a class=anchor href=#%e6%98%af%e4%bb%80%e4%b9%88>#</a></h2><p><a href=https://nats.io/about/>Home</a>,
<a href=https://github.com/nats-io/nats-server>Github</a></p><blockquote><p>NATS 是一个简单、安全和高性能的通信系统，适用于数字系统、服务和设备。</p><p>NATS 是一种允许以消息形式分段的数据交换的基础架构。</p></blockquote><h3 id=基于主题>基于主题
<a class=anchor href=#%e5%9f%ba%e4%ba%8e%e4%b8%bb%e9%a2%98>#</a></h3><p>发布者将消息发到主题；订阅者订阅主题，在有消息到来时消费该消息。</p><blockquote><p>主题命名规则：</p><p>基本字符：a to z, A to Z and 0 to 9 (区分大小写，不能包含空白字符).</p><p>特殊字符: <code>.</code> (分割符，分割不同部分，每部分视为一个token)； * 和 > (通配符，*表示匹配一个token，>表示匹配一或多个token).</p><p>保留主题名称: 以 $ 开头的用在系统内部 (如：$SYS, $JS, $KV &mldr;)</p></blockquote><h3 id=发布-订阅>发布-订阅
<a class=anchor href=#%e5%8f%91%e5%b8%83-%e8%ae%a2%e9%98%85>#</a></h3><p>Core NATS: 一个主题，存在一个发布者，多个订阅者。</p><p>消息会<code>复制</code>到多个订阅者。</p><h3 id=请求-响应>请求-响应
<a class=anchor href=#%e8%af%b7%e6%b1%82-%e5%93%8d%e5%ba%94>#</a></h3><blockquote><p>A request is sent, and the application either waits on the response with a certain timeout, or receives a response asynchronously.</p><p>&ndash; 请求发出后，应用要不等待响应超时，要不就异步收到一个响应。</p><a href=/posts/2023/04/nats/>...</a></p></article><article class="markdown book-post"><h2><a href=/posts/2023/01/go_generic_join/>Go Generic Join</a></h2><h5>January 6, 2023</h5><div><a href=/categories/go/>Go</a>,
<a href=/categories/generic/>Generic</a>,
<a href=/categories/join/>Join</a></div><div><a href=/tags/join/>Join</a></div><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// NestedJoin like nested loop join
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NestedJoin</span>[<span style=color:#a6e22e>J</span>, <span style=color:#a6e22e>K</span>, <span style=color:#a6e22e>R</span> <span style=color:#a6e22e>any</span>](
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>left</span> []<span style=color:#a6e22e>J</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>right</span> []<span style=color:#a6e22e>K</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>match</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>J</span>, <span style=color:#a6e22e>K</span>) <span style=color:#66d9ef>bool</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mapper</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>J</span>, <span style=color:#a6e22e>K</span>) <span style=color:#a6e22e>R</span>,
</span></span><span style=display:flex><span>) []<span style=color:#a6e22e>R</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>r</span> = make([]<span style=color:#a6e22e>R</span>, <span style=color:#ae81ff>0</span>, len(<span style=color:#a6e22e>left</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>j</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>left</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>k</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>right</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>j</span>, <span style=color:#a6e22e>k</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>r</span> = append(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>mapper</span>(<span style=color:#a6e22e>j</span>, <span style=color:#a6e22e>k</span>))
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// HashJoin like hash join
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>HashJoin</span>[<span style=color:#a6e22e>K</span> <span style=color:#a6e22e>comparable</span>, <span style=color:#a6e22e>LE</span>, <span style=color:#a6e22e>RE</span>, <span style=color:#a6e22e>R</span> <span style=color:#a6e22e>any</span>](
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>left</span> []<span style=color:#a6e22e>LE</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>right</span> []<span style=color:#a6e22e>RE</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>lk</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>item</span> <span style=color:#a6e22e>LE</span>) <span style=color:#a6e22e>K</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>rk</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>item</span> <span style=color:#a6e22e>RE</span>) <span style=color:#a6e22e>K</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mapper</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>LE</span>, <span style=color:#a6e22e>RE</span>) <span style=color:#a6e22e>R</span>,
</span></span><span style=display:flex><span>) []<span style=color:#a6e22e>R</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>r</span> = make([]<span style=color:#a6e22e>R</span>, <span style=color:#ae81ff>0</span>, len(<span style=color:#a6e22e>left</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>rm</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>KeyBy</span>(<span style=color:#a6e22e>right</span>, <span style=color:#a6e22e>rk</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>le</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>left</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>k</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lk</span>(<span style=color:#a6e22e>le</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>re</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rm</span>[<span style=color:#a6e22e>k</span>]
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>r</span> = append(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>mapper</span>(<span style=color:#a6e22e>le</span>, <span style=color:#a6e22e>re</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><a href=https://github.com/donnol/do>Code From</a></p><a href=/posts/2023/01/go_generic_join/>...</a></p></article><article class="markdown book-post"><h2><a href=/posts/2022/05/generic/>泛型</a></h2><h5>May 30, 2022</h5><div><a href=/categories/go/>Go</a>,
<a href=/categories/typescript/>TypeScript</a></div><div><a href=/tags/generic/>Generic</a></div><p><h1 id=泛型>泛型
<a class=anchor href=#%e6%b3%9b%e5%9e%8b>#</a></h1><h2 id=是什么>是什么？
<a class=anchor href=#%e6%98%af%e4%bb%80%e4%b9%88>#</a></h2><p>Type parameter, 类型参数。<code>func Add[T Number](x, y T) (r T)</code>，其中的<code>T</code>就是类型参数，它被接口<code>Number</code>所约束。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Number</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> | <span style=color:#66d9ef>float32</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>调用方除了可自行决定参数值之外，还可以自行决定参数类型。<code>Add[int](1, 2)</code>，在调用时指定<code>T</code>的类型为<code>int</code>，同时传入参数值<code>1</code>,<code>2</code>必须是<code>int</code>类型。</p><p>这样使得代码更灵活，更有扩展性，同时更安全。</p><h2 id=go泛型>Go泛型
<a class=anchor href=#go%e6%b3%9b%e5%9e%8b>#</a></h2><h3 id=为什么>为什么？
<a class=anchor href=#%e4%b8%ba%e4%bb%80%e4%b9%88>#</a></h3><p>静态语言，类型固定，比如这个函数：<code>func Add(x, y int) int</code>就要求参数和结果都必须是整型。</p><p>那如果后来又需要一个浮点数的加法呢？</p><p><img src=/image/%e5%9b%ba%e5%ae%9a%e7%b1%bb%e5%9e%8b.png alt=固定类型></p><p>那使用interface{}不也可以吗？</p><p><img src=/image/any%e7%b1%bb%e5%9e%8b.png alt=固定类型></p><p>试看：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 准确的描述出了参数和返回值的类型，非常方便
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 但也限制了Add函数的参数类型--只能接收`int`
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Add(0.1, 0.2) // can&#39;t do that
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 那怎么办呢？再写一个针对float64的呗
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AddFloat64</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#66d9ef>float64</span>) <span style=color:#66d9ef>float64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>AddFloat64</span>(<span style=color:#ae81ff>0.1</span>, <span style=color:#ae81ff>0.2</span>) <span style=color:#75715e>// it&#39;s ok
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 如果还要支持其它类型呢？再加一个吗，每多一种类型，就多加一个。。。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AddInt8</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#66d9ef>int8</span>) <span style=color:#66d9ef>int8</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AddInt32</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#66d9ef>int32</span>) <span style=color:#66d9ef>int32</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AddFloat32</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#66d9ef>float32</span>) <span style=color:#66d9ef>float32</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// more...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// emm.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// how about interface{}?
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AddAny</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>x</span>.(<span style=color:#66d9ef>type</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>int</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>int8</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>int32</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>float32</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>float64</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e>// more...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>        panic(<span style=color:#e6db74>&#34;not support type&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// interface{}表示可以接收任意类型的值，并且返回任意类型的值
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 换言之，参数的类型和返回值的类型没有必然联系--从签名看来，它们可以一样，也可以不一样
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 所以，使用interface{}不够安全。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AddGeneric1</span>[<span style=color:#a6e22e>T</span> <span style=color:#a6e22e>any</span>](<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#a6e22e>T</span>) <span style=color:#a6e22e>T</span> <span style=color:#75715e>// 看起来跟AddAny差不多，但是参数类型和返回值类型必然是相同的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 但any并不一定支持+运算符，所以需要用更细粒度的约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Number</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    ~<span style=color:#66d9ef>int</span>|~<span style=color:#66d9ef>int8</span>|~<span style=color:#66d9ef>int32</span>|~<span style=color:#66d9ef>float32</span>|~<span style=color:#66d9ef>float64</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AddGeneric2</span>[<span style=color:#a6e22e>T</span> <span style=color:#a6e22e>Number</span>](<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#a6e22e>T</span>) <span style=color:#a6e22e>T</span> <span style=color:#75715e>// 通过Number约束，确保类型参数可加
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 泛型的存在，使得函数的类型集比any小，比int大；使得返回值和参数的类型能够动态联系。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Map</span>[<span style=color:#a6e22e>T</span>, <span style=color:#a6e22e>E</span> <span style=color:#a6e22e>any</span>](<span style=color:#a6e22e>list</span> []<span style=color:#a6e22e>T</span>, <span style=color:#a6e22e>f</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>T</span>) <span style=color:#a6e22e>E</span>) []<span style=color:#a6e22e>E</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> make([]<span style=color:#a6e22e>E</span>, len(<span style=color:#a6e22e>list</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>list</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>r</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#a6e22e>f</span>(<span style=color:#a6e22e>list</span>[<span style=color:#a6e22e>i</span>])
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><img src=/image/%e7%b1%bb%e5%9e%8b%e5%8f%82%e6%95%b0.png alt=类型参数></p><a href=/posts/2022/05/generic/>...</a></p></article><article class="markdown book-post"><h2><a href=/posts/2022/05/find_go_version_the_app_use/>Find out which Go version built your binary</a></h2><h5>May 27, 2022</h5><div><a href=/categories/go/>Go</a></div><div><a href=/tags/version/>Version</a></div><p><h1 id=根据二进制文件找出应用构建时使用的go版本>根据二进制文件找出应用构建时使用的<code>Go</code>版本
<a class=anchor href=#%e6%a0%b9%e6%8d%ae%e4%ba%8c%e8%bf%9b%e5%88%b6%e6%96%87%e4%bb%b6%e6%89%be%e5%87%ba%e5%ba%94%e7%94%a8%e6%9e%84%e5%bb%ba%e6%97%b6%e4%bd%bf%e7%94%a8%e7%9a%84go%e7%89%88%e6%9c%ac>#</a></h1><p>使用
<a href=https://github.com/go-delve/delve/blob/master/Documentation/installation><code>dlv</code></a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>dlv exec ./app
</span></span><span style=display:flex><span>&gt; p runtime.buildVerion
</span></span></code></pre></div><p>或者，在代码里调用<code>runtime.Version()</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;go version:&#34;</span>, <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Version</span>())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><a href=https://dave.cheney.net/2017/06/20/how-to-find-out-which-go-version-built-your-binary>参照</a></p></p></article><article class="markdown book-post"><h2><a href=/posts/2022/05/go_enum/>Go enum</a></h2><h5>May 12, 2022</h5><div><a href=/categories/go/>Go</a></div><div><a href=/tags/enum/>Enum</a></div><p><h1 id=go-enum>Go enum
<a class=anchor href=#go-enum>#</a></h1><p>Go是没有内置枚举类型的，那么，当需要使用枚举时，该怎么办呢？</p><p>枚举说白了，就是一连串<code>互斥的值</code>，每个值代表一样事物或一个类型。</p><p>比如，现在需要一个颜色枚举，可以这样定义：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Red</span> = <span style=color:#e6db74>&#34;Red&#34;</span> <span style=color:#75715e>// 红色
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Blue</span> = <span style=color:#e6db74>&#34;Blue&#34;</span> <span style=color:#75715e>// 蓝色
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Green</span> = <span style=color:#e6db74>&#34;Green&#34;</span> <span style=color:#75715e>// 绿色
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>)
</span></span></code></pre></div><p>也有这样定义的：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Color</span> <span style=color:#66d9ef>string</span> <span style=color:#75715e>// 定义一个特定类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 枚举常量均声明为该类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Red</span>     <span style=color:#a6e22e>Color</span> = <span style=color:#e6db74>&#34;Red&#34;</span> <span style=color:#75715e>// 红色
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Blue</span>    <span style=color:#a6e22e>Color</span> = <span style=color:#e6db74>&#34;Blue&#34;</span> <span style=color:#75715e>// 蓝色
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Green</span>   <span style=color:#a6e22e>Color</span> = <span style=color:#e6db74>&#34;Green&#34;</span> <span style=color:#75715e>// 绿色
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>)
</span></span></code></pre></div><p>这样做的好处是可以通过这个类型来更明显的标记出枚举字段来：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Car</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Color</span> <span style=color:#a6e22e>Color</span> <span style=color:#75715e>// 颜色字段声明为Color类型，在阅读代码的时候就能知道这个字段正常的可选值范围
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>但是，上面的做法都需要面临一个问题，就是我需要一个返回全部枚举值的集合时，需要这样做：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>All</span>() []<span style=color:#a6e22e>Color</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> []<span style=color:#a6e22e>Color</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Red</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Blue</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Green</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>color</span> <span style=color:#a6e22e>Color</span>) <span style=color:#a6e22e>Name</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>color</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Red</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;红色&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Blue</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;蓝色&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Green</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;绿色&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>当在定义处新增值时，<code>All</code>和<code>Name</code>也要同步添加，对于开发人员来说，非常容易遗漏。</p><a href=/posts/2022/05/go_enum/>...</a></p></article><article class="markdown book-post"><h2><a href=/posts/2022/04/go1.18_comparable/>Go1.18 comparable</a></h2><h5>April 22, 2022</h5><div><a href=/categories/go/>Go</a></div><div><a href=/tags/comparable/>Comparable</a></div><p><h1 id=go-118-预定义接口类型>Go 1.18 预定义接口类型
<a class=anchor href=#go-118-%e9%a2%84%e5%ae%9a%e4%b9%89%e6%8e%a5%e5%8f%a3%e7%b1%bb%e5%9e%8b>#</a></h1><p>先看一个提案:
<a href=https://github.com/golang/go/issues/51338>proposal: spec: permit values to have type &ldquo;comparable&rdquo;</a> &ndash; 允许值拥有<code>comparable</code>类型，我的理解是，现在的<code>comparable</code>只能用作泛型里的类型参数的约束，不能像普通类型那样使用，如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Set</span>[<span style=color:#a6e22e>E</span> <span style=color:#a6e22e>comparable</span>] []<span style=color:#a6e22e>E</span> <span style=color:#75715e>// 可以用做类型参数的约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用go1.18编译，报错：interface is (or embeds) comparable
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>A</span> <span style=color:#a6e22e>comparable</span> <span style=color:#75715e>// 变量不可以使用`comparable`类型
</span></span></span></code></pre></div><p>那么，结合例子就能更好地理解这个提案了。</p><p>这个提案的主要目的就是让例子里的<code>var A comparable</code>成立，也就是允许<code>comparable</code>作为变量的类型，跟其它普通的接口类型(<code>var E error</code>)一样。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// proposal: spec: permit values to have type &#34;comparable&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// As part of adding generics, Go 1.18 introduces a new predeclared interface type comparable. That interface type is implemented by any non-interface type that is comparable, and by any interface type that is or embeds comparable. Comparable non-interface types are numeric, string, boolean, pointer, and channel types, structs all of whose field types are comparable, and arrays whose element types are comparable. Slice, map, and function types are not comparable.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// -- 作为泛型的一部分，Go1.18引入了一个新的预定义接口类型：`comparable`。这个接口类型由任何可比较的非接口类型实现，和任何是`comparable`或内嵌了`comparable`的接口类型实现。可比较的非接口类型有：数值、字符串、布尔、指针、字段类型均是可比较的管道或结构体类型、元素是可比较的数组类型。切片、映射、函数类型均是不可比较的。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// In Go, interface types are comparable in the sense that they can be compared with the == and != operators. However, interface types do not in general implement the predeclared interface type comparable. An interface type only implements comparable if it is or embeds comparable.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 在Go里面，接口类型是可比较的意味着它们可以用`==`和`!=`操作符进行比较。但是，接口类型一般来说没有实现预定义接口类型`comparable`。一个接口类型只有它是或内嵌了`comparable`时才实现了`comparable`。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Developing this distinction between the predeclared type comparable and the general language notion of comparable has been confusing; see #50646. The distinction makes it hard to write certain kinds of generic code; see #51257.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 出现的两个问题：[怎么在文档里说明哪些接口实现它了呢？](https://github.com/golang/go/issues/50646), [any是任意类型的意思，那必然比comparable大吧](https://github.com/golang/go/issues/51257)
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 突然想到：如果我要把一个变量表示为不可比较的，怎么样可以用`comparable`来表示呢，`!comparable`?
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// For a specific example, you can today write a generic Set type of some specific (comparable) element type and write functions that work on sets of any element type:
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 
</span></span></span><span style=display:flex><span><span style=color:#75715e>// type Set[E comparable] map[E]bool
</span></span></span><span style=display:flex><span><span style=color:#75715e>// func Union[E comparable](s1, s2 Set[E]) Set[E] { ... }
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 
</span></span></span><span style=display:flex><span><span style=color:#75715e>// But there is no way today to instantiate this Set type to create a general set that works for any (comparable) value. That is, you can&#39;t write Set[any], because any does not satisfy the constraint comparable. You can get a very similar effect by writing map[any]bool, but then all the functions like Union have to be written anew for this new version.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// We can reduce this kind of problem by permitting comparable to be an ordinary type. It then becomes possible to write Set[comparable].
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// As an ordinary type, comparable would be an interface type that is implemented by any comparable type.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 作为一个普通类型，`comparable`是一个可以被任意`comparable`类型实现的接口类型。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Any comparable non-interface type could be assigned to a variable of type comparable.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// -- 任何可比较的非接口类型可以被分配到类型为`comparable`的变量。
</span></span></span><span style=display:flex><span><span style=color:#75715e>// A value of an interface type that is or embeds comparable could be assigned to a variable of type comparable.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// -- 接口类型是或内嵌了`comparable`的值可以被分配到类型为`comparable`的变量。
</span></span></span><span style=display:flex><span><span style=color:#75715e>// A type assertion to comparable, as in x.(comparable), would succeed if the dynamic type of x is a comparable type.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 类型断言，如`x.(comparable)`，当x的动态类型是一个`comparable`类型时可以成功。
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Similarly for a type switch case comparable.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 对`type switch`来说类似。
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>C</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>comparable</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>c</span> <span style=color:#a6e22e>C</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>A</span> <span style=color:#a6e22e>comparable</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>a</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>v</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>a</span>.(<span style=color:#a6e22e>comparable</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>a</span>.(<span style=color:#66d9ef>type</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>comparable</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=反射的comparable>反射的<code>Comparable</code>
<a class=anchor href=#%e5%8f%8d%e5%b0%84%e7%9a%84comparable>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ReflectComparable</span>(<span style=color:#a6e22e>v</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>typ</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>TypeOf</span>(<span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Comparable reports whether values of this type are comparable.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// Even if Comparable returns true, the comparison may still panic.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// For example, values of interface type are comparable,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// but the comparison will panic if their dynamic type is not comparable.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// -- 即使返回true，也有可能panic。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// 比如：接口类型的值是可比较的，但如果它们的动态类型是不可比较的，就会panic
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>typ</span>.<span style=color:#a6e22e>Comparable</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=gotypes的comparable>go/types的<code>Comparable</code>
<a class=anchor href=#gotypes%e7%9a%84comparable>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TypesComparable</span>() <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>t</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>NewChan</span>(<span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>SendOnly</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>Basic</span>{})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>Comparable</span>(<span style=color:#a6e22e>t</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=更新>更新
<a class=anchor href=#%e6%9b%b4%e6%96%b0>#</a></h2><p><a href=https://github.com/golang/go/issues/52614>使comparable仅在类型集里没有任何一个不可比较类型时正确，否则依然在编译时可通过，但运行时panic</a></p><a href=/posts/2022/04/go1.18_comparable/>...</a></p></article><ul class="pagination pagination-default"><li class="page-item disabled"><a aria-disabled=true aria-label=First class=page-link role=button tabindex=-1><span aria-hidden=true>&#171;&#171;</span></a></li><li class="page-item disabled"><a aria-disabled=true aria-label=Previous class=page-link role=button tabindex=-1><span aria-hidden=true>&#171;</span></a></li><li class="page-item active"><a aria-current=page aria-label="Page 1" class=page-link role=button>1</a></li><li class=page-item><a href=/categories/go/page/2/ aria-label="Page 2" class=page-link role=button>2</a></li><li class=page-item><a href=/categories/go/page/2/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/categories/go/page/2/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav><ul><li class=book-section-flat><strong>Categories</strong><ul><li class="flex justify-between"><a href=/categories/db/>DB</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/mysql-8/>Mysql 8</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/rust/>Rust</a>
<span>3</span></li><li class="flex justify-between"><a href=/categories/wezterm/>Wezterm</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/snowflake/>Snowflake</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/time/>Time</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/do/>Do</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/escape-analysis/>Escape Analysis</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/go/>Go</a>
<span>17</span></li><li class="flex justify-between"><a href=/categories/mysql/>Mysql</a>
<span>3</span></li><li class="flex justify-between"><a href=/categories/vscode/>Vscode</a>
<span>3</span></li><li class="flex justify-between"><a href=/categories/windows/>Windows</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/prometheus/>Prometheus</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/compare/>Compare</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/order/>Order</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/sklearn/>Sklearn</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/route/>Route</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/wsl2/>Wsl2</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/element/>Element</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/flutter/>Flutter</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/widget/>Widget</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/router/>Router</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/nats/>NATS</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/generic/>Generic</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/join/>Join</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/number/>Number</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/structure/>Structure</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/typescript/>TypeScript</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/k8s/>K8s</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/algorithm/>Algorithm</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/kmp/>KMP</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/frostmourne/>Frostmourne</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/goroutine/>Goroutine</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/tokio/>Tokio</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/chan/>Chan</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/runtime/>Runtime</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/distractions/>Distractions</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/work/>Work</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/wasi/>Wasi</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/wasm/>Wasm</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/blockchain/>Blockchain</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/container/>Container</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/docker/>Docker</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/image/>Image</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/smart-contract/>Smart Contract</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/consensus/>Consensus</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/red-black-tree/>Red-Black-Tree</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/tree/>Tree</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/cache/>Cache</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/database/>Database</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/linux/>Linux</a>
<span>3</span></li><li class="flex justify-between"><a href=/categories/%E6%9D%82%E5%BF%B5/>杂念</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/etcd/>Etcd</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/vscode-go/>Vscode-Go</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/message-queue/>Message Queue</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/redis/>Redis</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/book/>Book</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/dbmanager/>Dbmanager</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/ddd/>Ddd</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/blog/>Blog</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/tools/>Tools</a>
<span>1</span></li></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/mark/>Mark</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/note/>Note</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/restart-remote-service/>Restart-Remote-Service</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/translate/>Translate</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/prometheus/>Prometheus</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/thought/>Thought</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ml/>Ml</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/route/>Route</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/mysql/>Mysql</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/flutter/>Flutter</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/mysqlrouter/>Mysqlrouter</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/nats/>NATS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/join/>Join</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/calculate/>Calculate</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/jump-table/>Jump Table</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/generic/>Generic</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/version/>Version</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/pod/>Pod</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/enum/>Enum</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/comparable/>Comparable</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/workspace/>Workspace</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/concurrent/>Concurrent</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/chan/>Chan</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/safe/>Safe</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/wasmtime/>Wasmtime</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/encrypt/>Encrypt</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/eth/>Eth</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/evm/>Evm</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/learn/>Learn</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/deal/>Deal</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/data-struct/>Data-Struct</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/crate/>Crate</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/redis/>Redis</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ebpf/>Ebpf</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/%E6%96%87%E5%AD%97/>文字</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/%E6%97%B6%E9%97%B4/>时间</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/gomod/>Gomod</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/raft/>Raft</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/mqtt/>Mqtt</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/sds/>Sds</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ddia/>Ddia</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/k8s/>K8s</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/compose/>Compose</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/cpu/>Cpu</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/dbeaver/>Dbeaver</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/domain/>Domain</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/deploy/>Deploy</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/epoll/>Epoll</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/aop/>Aop</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/hugo/>Hugo</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/proxy/>Proxy</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ctx/>Ctx</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/pstree/>Pstree</a>
<span>1</span></li></ul></li></ul></nav></div></aside></main></body></html>