<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="是什么？ # Home, Github
NATS 是一个简单、安全和高性能的通信系统，适用于数字系统、服务和设备。
NATS 是一种允许以消息形式分段的数据交换的基础架构。
基于主题 # 发布者将消息发到主题；订阅者订阅主题，在有消息到来时消费该消息。
主题命名规则：
基本字符：a to z, A to Z and 0 to 9 (区分大小写，不能包含空白字符).
特殊字符: . (分割符，分割不同部分，每部分视为一个token)； * 和 > (通配符，*表示匹配一个token，>表示匹配一或多个token).
保留主题名称: 以 $ 开头的用在系统内部 (如：$SYS, $JS, $KV &mldr;)
发布-订阅 # Core NATS: 一个主题，存在一个发布者，多个订阅者。
消息会复制到多个订阅者。
请求-响应 # A request is sent, and the application either waits on the response with a certain timeout, or receives a response asynchronously.
&ndash; 请求发出后，应用要不等待响应超时，要不就异步收到一个响应。"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="NATS"><meta property="og:description" content="是什么？ # Home, Github
NATS 是一个简单、安全和高性能的通信系统，适用于数字系统、服务和设备。
NATS 是一种允许以消息形式分段的数据交换的基础架构。
基于主题 # 发布者将消息发到主题；订阅者订阅主题，在有消息到来时消费该消息。
主题命名规则：
基本字符：a to z, A to Z and 0 to 9 (区分大小写，不能包含空白字符).
特殊字符: . (分割符，分割不同部分，每部分视为一个token)； * 和 > (通配符，*表示匹配一个token，>表示匹配一或多个token).
保留主题名称: 以 $ 开头的用在系统内部 (如：$SYS, $JS, $KV &mldr;)
发布-订阅 # Core NATS: 一个主题，存在一个发布者，多个订阅者。
消息会复制到多个订阅者。
请求-响应 # A request is sent, and the application either waits on the response with a certain timeout, or receives a response asynchronously.
&ndash; 请求发出后，应用要不等待响应超时，要不就异步收到一个响应。"><meta property="og:type" content="article"><meta property="og:url" content="https://donnol.github.io/posts/2023/04/nats/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-24T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-24T00:00:00+00:00"><title>NATS | 我的简单博客</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.95d69eb6bad8b9707ff2b5d8d9e31ce70a1b84f2ed7ffaf665ffcf00aa7993bd.css integrity="sha256-ldaetrrYuXB/8rXY2eMc5wobhPLtf/r2Zf/PAKp5k70=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.78166b9d46e23e0ea915cb6887a30b633e7bc4fad10c8b6b9f6fa532271c19ba.js integrity="sha256-eBZrnUbiPg6pFctoh6MLYz57xPrRDItrn2+lMiccGbo=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PNRWGCH4KN"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PNRWGCH4KN",{anonymize_ip:!1})}</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>我的简单博客</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-313b4fa1ecd54472a2ea5583fbdf1f19 class=toggle checked>
<label for=section-313b4fa1ecd54472a2ea5583fbdf1f19 class="flex justify-between"><a role=button>2023</a></label><ul><li><input type=checkbox id=section-8c180e0ce17abb68ae87c9e39d004c01 class=toggle>
<label for=section-8c180e0ce17abb68ae87c9e39d004c01 class="flex justify-between"><a role=button>05</a></label><ul><li><a href=https://donnol.github.io/posts/2023/05/mysqlrouter/>mysqlrouter使用</a></li></ul></li><li><input type=checkbox id=section-479bac08fe89212eeabe2bdb9d86347a class=toggle checked>
<label for=section-479bac08fe89212eeabe2bdb9d86347a class="flex justify-between"><a role=button>04</a></label><ul><li><a href=https://donnol.github.io/posts/2023/04/nats/ class=active>NATS</a></li></ul></li><li><input type=checkbox id=section-950a92f3ca235700f7752b33a7d3d434 class=toggle>
<label for=section-950a92f3ca235700f7752b33a7d3d434 class="flex justify-between"><a role=button>01</a></label><ul><li><a href=https://donnol.github.io/posts/2023/01/go_generic_join/>Go Generic Join</a></li></ul></li></ul></li><li><input type=checkbox id=section-c8e9ae7896ddc3e931652e7edbcbefe2 class=toggle>
<label for=section-c8e9ae7896ddc3e931652e7edbcbefe2 class="flex justify-between"><a role=button>2022</a></label><ul><li><input type=checkbox id=section-3811be776c86ac852ad674f5dc19e532 class=toggle>
<label for=section-3811be776c86ac852ad674f5dc19e532 class="flex justify-between"><a role=button>07</a></label><ul><li><a href=https://donnol.github.io/posts/2022/07/jump_table/>Jump Table</a></li><li><a href=https://donnol.github.io/posts/2022/07/number_calculate/>数字计算之分摊</a></li></ul></li><li><input type=checkbox id=section-d9a952ec7a0fcb7a9ba717dc9bfce17b class=toggle>
<label for=section-d9a952ec7a0fcb7a9ba717dc9bfce17b class="flex justify-between"><a role=button>05</a></label><ul><li><a href=https://donnol.github.io/posts/2022/05/generic/>泛型</a></li><li><a href=https://donnol.github.io/posts/2022/05/find_go_version_the_app_use/>Find out which Go version built your binary</a></li><li><a href=https://donnol.github.io/posts/2022/05/k8s_how_to_keep_pods/>k8s是怎么维持pod的运行的呢？</a></li><li><a href=https://donnol.github.io/posts/2022/05/go_enum/>Go enum</a></li></ul></li><li><input type=checkbox id=section-98bace91040a47ec7d7a95076963fc62 class=toggle>
<label for=section-98bace91040a47ec7d7a95076963fc62 class="flex justify-between"><a role=button>04</a></label><ul><li><a href=https://donnol.github.io/posts/2022/04/go1.18_comparable/>Go1.18 comparable</a></li></ul></li><li><input type=checkbox id=section-821dedbe2a29b27962c9696b13382042 class=toggle>
<label for=section-821dedbe2a29b27962c9696b13382042 class="flex justify-between"><a role=button>03</a></label><ul><li><a href=https://donnol.github.io/posts/2022/03/kmp/>KMP</a></li></ul></li><li><input type=checkbox id=section-935ca4c1d23ab780a0809b4bc7c413bf class=toggle>
<label for=section-935ca4c1d23ab780a0809b4bc7c413bf class="flex justify-between"><a role=button>02</a></label><ul><li><a href=https://donnol.github.io/posts/2022/02/%E9%9C%9C%E4%B9%8B%E5%93%80%E4%BC%A4/>霜之哀伤</a></li><li><a href=https://donnol.github.io/posts/2022/02/goroutine_vs_tokio/>goroutine vs tokio</a></li><li><a href=https://donnol.github.io/posts/2022/02/go_runtime_chan/>go runtime chan</a></li><li><a href=https://donnol.github.io/posts/2022/02/go_work/>go work</a></li><li><a href=https://donnol.github.io/posts/2022/02/distractions/>杂念</a></li></ul></li><li><input type=checkbox id=section-a7c5705090b10b47e082065e722e7e5c class=toggle>
<label for=section-a7c5705090b10b47e082065e722e7e5c class="flex justify-between"><a role=button>01</a></label><ul><li><a href=https://donnol.github.io/posts/2022/01/rust_safe/>Rust与安全</a></li><li><a href=https://donnol.github.io/posts/2022/01/wasmtime/>wasm运行时wasmtime</a></li><li><a href=https://donnol.github.io/posts/2022/01/container_encrypt/>容器镜像加密</a></li><li><a href=https://donnol.github.io/posts/2022/01/smart_contract/>智能合约</a></li><li><a href=https://donnol.github.io/posts/2022/01/learn_go_fast/>Go快速入门</a></li><li><a href=https://donnol.github.io/posts/2022/01/consensus/>consensus</a></li><li><a href=https://donnol.github.io/posts/2022/01/red_black_tree/>红黑树</a></li><li><a href=https://donnol.github.io/posts/2022/01/rust_commonly_used_crate/>Rust常用库</a></li><li><a href=https://donnol.github.io/posts/2022/01/cache/>缓存和数据库如何保持一致</a></li></ul></li><li><input type=checkbox id=section-f8031d80c43eae0ab94501ccf76874e3 class=toggle>
<label for=section-f8031d80c43eae0ab94501ccf76874e3 class="flex justify-between"><a role=button>12</a></label><ul></ul></li></ul></li><li><input type=checkbox id=section-71121fe02c394c786aa5fdaffc9e5412 class=toggle>
<label for=section-71121fe02c394c786aa5fdaffc9e5412 class="flex justify-between"><a role=button>2021</a></label><ul><li><input type=checkbox id=section-393d931b698132759df1a7089df0fcc8 class=toggle>
<label for=section-393d931b698132759df1a7089df0fcc8 class="flex justify-between"><a role=button>12</a></label><ul><li><a href=https://donnol.github.io/posts/2021/12/ebpf/>ebpf</a></li><li><a href=https://donnol.github.io/posts/2021/12/time_wenzi/>时间和文字</a></li><li><a href=https://donnol.github.io/posts/2021/12/etcd/>etcd</a></li><li><a href=https://donnol.github.io/posts/2021/12/vscode-go-module/>vscode-go在go.mod在非根目录情况下失效的问题</a></li><li><a href=https://donnol.github.io/posts/2021/12/mqtt/>mqtt</a></li><li><a href=https://donnol.github.io/posts/2021/12/redis_sds/>redis sds</a></li><li><a href=https://donnol.github.io/posts/2021/12/k8s/>k8s</a></li><li><a href=https://donnol.github.io/posts/2021/12/ddia/>数据密集型应用设计</a></li><li><a href=https://donnol.github.io/posts/2021/12/burn_cpu_use_golang/>burn cpu use golang</a></li><li><a href=https://donnol.github.io/posts/2021/12/docker_compose_extra_host/>docker compose使用extra host让容器访问主机服务</a></li><li><a href=https://donnol.github.io/posts/2021/12/dbeaver/>数据库管理工具之dbeaver</a></li><li><a href=https://donnol.github.io/posts/2021/12/domain/>Domain-oriented development</a></li><li><a href=https://donnol.github.io/posts/2021/12/github_action_deploy_hugo_blog/>github action deploy hugo blog</a></li></ul></li><li><input type=checkbox id=section-b59662e33ca9ad77b7d385cbee7785fe class=toggle>
<label for=section-b59662e33ca9ad77b7d385cbee7785fe class="flex justify-between"><a role=button>07</a></label><ul><li><a href=https://donnol.github.io/posts/2021/07/linux-epoll/>linux epoll</a></li></ul></li><li><input type=checkbox id=section-3b66512bb507cbdaa9cef9549f229fc1 class=toggle>
<label for=section-3b66512bb507cbdaa9cef9549f229fc1 class="flex justify-between"><a role=button>01</a></label><ul><li><a href=https://donnol.github.io/posts/2021/01/proxy-between-layer/>Go实现AOP</a></li><li><a href=https://donnol.github.io/posts/2021/01/hugo-blog/>hugo搭建博客</a></li><li><a href=https://donnol.github.io/posts/2021/01/pstree/>pstree进程树及说明</a></li></ul></li></ul></li><li><input type=checkbox id=section-6f89cc6c76d5375fc02e3f7e596280b9 class=toggle>
<label for=section-6f89cc6c76d5375fc02e3f7e596280b9 class="flex justify-between"><a role=button>2020</a></label><ul><li><input type=checkbox id=section-03db05476b76e7f4afe06dfa3e1b675b class=toggle>
<label for=section-03db05476b76e7f4afe06dfa3e1b675b class="flex justify-between"><a role=button>12</a></label><ul><li><a href=https://donnol.github.io/posts/2020/12/go-ctx/>go ctx</a></li></ul></li></ul></li><li><a href=https://donnol.github.io/posts/aboutme/about-me/>关于我</a></li></ul><ul><li><a href=https://github.com/donnol/blog target=_blank rel=noopener>Github</a></li><li><a href=https://themes.gohugo.io/hugo-book/ target=_blank rel=noopener>Hugo Themes</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>NATS</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#是什么>是什么？</a><ul><li><a href=#基于主题>基于主题</a></li><li><a href=#发布-订阅>发布-订阅</a></li><li><a href=#请求-响应>请求-响应</a></li><li><a href=#queue-groups>Queue groups</a></li></ul></li><li><a href=#为什么>为什么？</a></li><li><a href=#qos>QOS</a></li><li><a href=#持久化>持久化</a></li><li><a href=#内嵌nats服务到应用里>内嵌NATS服务到应用里</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1><a href=/posts/2023/04/nats/>NATS</a></h1><h5>April 24, 2023</h5><div><a href=/categories/go/>go</a>,
<a href=/categories/nats/>NATS</a></div><div><a href=/tags/nats/>NATS</a></div><h2 id=是什么>是什么？
<a class=anchor href=#%e6%98%af%e4%bb%80%e4%b9%88>#</a></h2><p><a href=https://nats.io/about/>Home</a>,
<a href=https://github.com/nats-io/nats-server>Github</a></p><blockquote><p>NATS 是一个简单、安全和高性能的通信系统，适用于数字系统、服务和设备。</p><p>NATS 是一种允许以消息形式分段的数据交换的基础架构。</p></blockquote><h3 id=基于主题>基于主题
<a class=anchor href=#%e5%9f%ba%e4%ba%8e%e4%b8%bb%e9%a2%98>#</a></h3><p>发布者将消息发到主题；订阅者订阅主题，在有消息到来时消费该消息。</p><blockquote><p>主题命名规则：</p><p>基本字符：a to z, A to Z and 0 to 9 (区分大小写，不能包含空白字符).</p><p>特殊字符: <code>.</code> (分割符，分割不同部分，每部分视为一个token)； * 和 > (通配符，*表示匹配一个token，>表示匹配一或多个token).</p><p>保留主题名称: 以 $ 开头的用在系统内部 (如：$SYS, $JS, $KV &mldr;)</p></blockquote><h3 id=发布-订阅>发布-订阅
<a class=anchor href=#%e5%8f%91%e5%b8%83-%e8%ae%a2%e9%98%85>#</a></h3><p>Core NATS: 一个主题，存在一个发布者，多个订阅者。</p><p>消息会<code>复制</code>到多个订阅者。</p><h3 id=请求-响应>请求-响应
<a class=anchor href=#%e8%af%b7%e6%b1%82-%e5%93%8d%e5%ba%94>#</a></h3><blockquote><p>A request is sent, and the application either waits on the response with a certain timeout, or receives a response asynchronously.</p><p>&ndash; 请求发出后，应用要不等待响应超时，要不就异步收到一个响应。</p></blockquote><p>TODO:</p><h3 id=queue-groups>Queue groups
<a class=anchor href=#queue-groups>#</a></h3><blockquote><p>if more subscribers are added to the same queue name, they become a queue group, and only one randomly chosen subscriber of the queue group will consume a message each time a message is received by the queue group.</p><p>如果多个订阅者被添加到同一个队列里，它们就成为一个队列组；当消息来时，只会随机选择一个订阅者来消费这条消息。</p></blockquote><p>消息生产后会由任意一个订阅者消费。(<code>分区</code>)</p><h2 id=为什么>为什么？
<a class=anchor href=#%e4%b8%ba%e4%bb%80%e4%b9%88>#</a></h2><h2 id=qos>QOS
<a class=anchor href=#qos>#</a></h2><blockquote><p>At most once QoS: Core NATS offers an at most once quality of service. If a subscriber is not listening on the subject (no subject match), or is not active when the message is sent, the message is not received. This is the same level of guarantee that TCP/IP provides. Core NATS is a fire-and-forget messaging system. It will only hold messages in memory and will never write messages directly to disk.
&ndash; 最多一次：如果订阅者没有监听subject，或者当消息被发送时不可用，它将接收不到该消息。这也是TCP/IP提供的同等保证。因为core NATS只会将消息存储在内存里，而不会存储到硬盘里。</p><p>At-least / exactly once QoS: If you need higher qualities of service (at least once and exactly once), or functionalities such as persistent streaming, de-coupled flow control, and Key/Value Store, you can use NATS JetStream, which is built in to the NATS server (but needs to be enabled). Of course, you can also always build additional reliability into your client applications yourself with proven and scalable reference designs such as acks and sequence numbers.
&ndash; 最少一次或刚好一次：使用JetStream模式。它会将消息存储到硬盘里，从而确保消息不会丢失。如果订阅者在消息发送时刚好离线了，在它恢复后，它将会继续消费该条消息。</p></blockquote><h2 id=持久化>持久化
<a class=anchor href=#%e6%8c%81%e4%b9%85%e5%8c%96>#</a></h2><p><code>jet stream</code>.</p><blockquote><p>JetStream was created to solve the problems identified with streaming in technology today - complexity, fragility, and a lack of scalability.
&ndash; 解决一些流的问题：复杂、碎片、扩展。</p></blockquote><h2 id=内嵌nats服务到应用里>内嵌NATS服务到应用里
<a class=anchor href=#%e5%86%85%e5%b5%8cnats%e6%9c%8d%e5%8a%a1%e5%88%b0%e5%ba%94%e7%94%a8%e9%87%8c>#</a></h2><p>单一进程里启动NATS服务。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#是什么>是什么？</a><ul><li><a href=#基于主题>基于主题</a></li><li><a href=#发布-订阅>发布-订阅</a></li><li><a href=#请求-响应>请求-响应</a></li><li><a href=#queue-groups>Queue groups</a></li></ul></li><li><a href=#为什么>为什么？</a></li><li><a href=#qos>QOS</a></li><li><a href=#持久化>持久化</a></li><li><a href=#内嵌nats服务到应用里>内嵌NATS服务到应用里</a></li></ul></li></ul></nav></div></aside></main></body></html>