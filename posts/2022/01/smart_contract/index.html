<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="智能合约 #   智能合约wiki
 （英语：Smart contract）是一种特殊协议，在区块链内制定合约时使用，当中内含了代码函数 (Function)，亦能与其他合约进行交互、做决策、存储资料及发送以太币等功能。智能合约主要提供验证及执行合约内所订立的条件。智能合约允许在没有第三方的情况下进行可信交易。这些交易可追踪且不可逆转。
 安全问题 #   智能合约是“执行合约条款的计算机交易协议”。区块链上的所有用户都可以看到基于区块链的智能合约。但是，这会导致包括安全漏洞在内的所有漏洞都可见，并且可能无法迅速修复。
这样的攻击难以迅速解决，例如：
 2016年6月The DAOEther的漏洞造成损失5000万美元，而开发者试图达成共识的解决方案。DAO的程序在黑客删除资金之前有一段时间的延迟。以太坊软件的一个硬分叉在时限到期之前完成了攻击者的资金回收工作。
 以太坊智能合约中的问题包括合约编程Solidity、编译器错误、以太坊虚拟机错误、对区块链网络的攻击、程序错误的不变性以及其他尚无文档记录的攻击。
 2018年4月22日， BeautyChain智能合约出现重大漏洞，黑客通过此漏洞无限生成代币，导致 BitEclipse (BEC)的价值接近归零。同月25日，SmartMesh出现疑似重大安全漏洞，宣布暂停所有SMT交易和转账直至另行通知，导致损失约1.4亿美金。28日，EOS被指可能存在BEC代币合约类似的整数溢出漏洞，但没消息详细说明。5月24日， BAI交易存在大量异常问题， 损失金额未知。8月22日， GODGAME 合约被黑客入侵，GOD智能合约上的以太坊总数归零。
  合约开发、测试和部署 #   eth智能合约文档
vending machine(自动售货机): money + snack selection = snack dispensed, 给钱并选择小吃，小吃就会出来 &ndash; 是给刚好的钱，还是过量的钱，过量了在发放小吃的同时退钱呢？
合约长这样：
// 表明使用的sol版本 pragma solidity 0.8.7;  // Solidity 合约类似于面向对象语言中的类。合约中有用于数据持久化的状态变量，和可以修改状态变量的函数。 调用另一个合约实例的函数时，会执行一个 EVM 函数调用，这个操作会切换执行时的上下文，这样，前一个合约的状态变量就不能访问了。 contract VendingMachine {   // Declare state variables of the contract  address public owner; // owner变量  mapping (address => uint) public cupcakeBalances; // cupcakeBalances变量   // 创建合约时，合约的构造函数会执行一次。构造函数是可选的。只允许有一个构造函数，这意味着不支持重载。  // When 'VendingMachine' contract is deployed:  // 1."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="智能合约"><meta property="og:description" content="智能合约 #   智能合约wiki
 （英语：Smart contract）是一种特殊协议，在区块链内制定合约时使用，当中内含了代码函数 (Function)，亦能与其他合约进行交互、做决策、存储资料及发送以太币等功能。智能合约主要提供验证及执行合约内所订立的条件。智能合约允许在没有第三方的情况下进行可信交易。这些交易可追踪且不可逆转。
 安全问题 #   智能合约是“执行合约条款的计算机交易协议”。区块链上的所有用户都可以看到基于区块链的智能合约。但是，这会导致包括安全漏洞在内的所有漏洞都可见，并且可能无法迅速修复。
这样的攻击难以迅速解决，例如：
 2016年6月The DAOEther的漏洞造成损失5000万美元，而开发者试图达成共识的解决方案。DAO的程序在黑客删除资金之前有一段时间的延迟。以太坊软件的一个硬分叉在时限到期之前完成了攻击者的资金回收工作。
 以太坊智能合约中的问题包括合约编程Solidity、编译器错误、以太坊虚拟机错误、对区块链网络的攻击、程序错误的不变性以及其他尚无文档记录的攻击。
 2018年4月22日， BeautyChain智能合约出现重大漏洞，黑客通过此漏洞无限生成代币，导致 BitEclipse (BEC)的价值接近归零。同月25日，SmartMesh出现疑似重大安全漏洞，宣布暂停所有SMT交易和转账直至另行通知，导致损失约1.4亿美金。28日，EOS被指可能存在BEC代币合约类似的整数溢出漏洞，但没消息详细说明。5月24日， BAI交易存在大量异常问题， 损失金额未知。8月22日， GODGAME 合约被黑客入侵，GOD智能合约上的以太坊总数归零。
  合约开发、测试和部署 #   eth智能合约文档
vending machine(自动售货机): money + snack selection = snack dispensed, 给钱并选择小吃，小吃就会出来 &ndash; 是给刚好的钱，还是过量的钱，过量了在发放小吃的同时退钱呢？
合约长这样：
// 表明使用的sol版本 pragma solidity 0.8.7;  // Solidity 合约类似于面向对象语言中的类。合约中有用于数据持久化的状态变量，和可以修改状态变量的函数。 调用另一个合约实例的函数时，会执行一个 EVM 函数调用，这个操作会切换执行时的上下文，这样，前一个合约的状态变量就不能访问了。 contract VendingMachine {   // Declare state variables of the contract  address public owner; // owner变量  mapping (address => uint) public cupcakeBalances; // cupcakeBalances变量   // 创建合约时，合约的构造函数会执行一次。构造函数是可选的。只允许有一个构造函数，这意味着不支持重载。  // When 'VendingMachine' contract is deployed:  // 1."><meta property="og:type" content="article"><meta property="og:url" content="https://donnol.github.io/posts/2022/01/smart_contract/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-26T00:00:00+00:00"><meta property="article:modified_time" content="2022-01-26T00:00:00+00:00"><title>智能合约 | 我的简单博客</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.09a284f5a03730d86dde350d2c062b1514e48fdfebba7763941c0674ef65748f.css integrity="sha256-CaKE9aA3MNht3jUNLAYrFRTkj9/rundjlBwGdO9ldI8=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.e59fbd9dbc7156ed32401b57c137595f7f04e6fc96d02655dcb243984dc63728.js integrity="sha256-5Z+9nbxxVu0yQBtXwTdZX38E5vyW0CZV3LJDmE3GNyg=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>我的简单博客</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-c8e9ae7896ddc3e931652e7edbcbefe2 class=toggle checked>
<label for=section-c8e9ae7896ddc3e931652e7edbcbefe2 class="flex justify-between"><a role=button>2022</a></label><ul><li><input type=checkbox id=section-821dedbe2a29b27962c9696b13382042 class=toggle>
<label for=section-821dedbe2a29b27962c9696b13382042 class="flex justify-between"><a role=button>03</a></label><ul><li><a href=https://donnol.github.io/posts/2022/03/kmp/>KMP</a></li></ul></li><li><input type=checkbox id=section-935ca4c1d23ab780a0809b4bc7c413bf class=toggle>
<label for=section-935ca4c1d23ab780a0809b4bc7c413bf class="flex justify-between"><a role=button>02</a></label><ul><li><a href=https://donnol.github.io/posts/2022/02/%E9%9C%9C%E4%B9%8B%E5%93%80%E4%BC%A4/>霜之哀伤</a></li><li><a href=https://donnol.github.io/posts/2022/02/goroutine_vs_tokio/>goroutine vs tokio</a></li><li><a href=https://donnol.github.io/posts/2022/02/go_runtime_chan/>go runtime chan</a></li><li><a href=https://donnol.github.io/posts/2022/02/go_work/>go work</a></li><li><a href=https://donnol.github.io/posts/2022/02/distractions/>杂念</a></li></ul></li><li><input type=checkbox id=section-a7c5705090b10b47e082065e722e7e5c class=toggle checked>
<label for=section-a7c5705090b10b47e082065e722e7e5c class="flex justify-between"><a role=button>01</a></label><ul><li><a href=https://donnol.github.io/posts/2022/01/rust_safe/>Rust与安全</a></li><li><a href=https://donnol.github.io/posts/2022/01/wasmtime/>wasm运行时wasmtime</a></li><li><a href=https://donnol.github.io/posts/2022/01/container_encrypt/>容器镜像加密</a></li><li><a href=https://donnol.github.io/posts/2022/01/smart_contract/ class=active>智能合约</a></li><li><a href=https://donnol.github.io/posts/2022/01/learn_go_fast/>Go快速入门</a></li><li><a href=https://donnol.github.io/posts/2022/01/consensus/>consensus</a></li><li><a href=https://donnol.github.io/posts/2022/01/red_black_tree/>红黑树</a></li><li><a href=https://donnol.github.io/posts/2022/01/rust_commonly_used_crate/>Rust常用库</a></li><li><a href=https://donnol.github.io/posts/2022/01/cache/>缓存和数据库如何保持一致</a></li></ul></li></ul></li><li><input type=checkbox id=section-71121fe02c394c786aa5fdaffc9e5412 class=toggle>
<label for=section-71121fe02c394c786aa5fdaffc9e5412 class="flex justify-between"><a role=button>2021</a></label><ul><li><input type=checkbox id=section-393d931b698132759df1a7089df0fcc8 class=toggle>
<label for=section-393d931b698132759df1a7089df0fcc8 class="flex justify-between"><a role=button>12</a></label><ul><li><a href=https://donnol.github.io/posts/2021/12/ebpf/>ebpf</a></li><li><a href=https://donnol.github.io/posts/2021/12/time_wenzi/>时间和文字</a></li><li><a href=https://donnol.github.io/posts/2021/12/etcd/>etcd</a></li><li><a href=https://donnol.github.io/posts/2021/12/vscode-go-module/>vscode-go在go.mod在非根目录情况下失效的问题</a></li><li><a href=https://donnol.github.io/posts/2021/12/mqtt/>mqtt</a></li><li><a href=https://donnol.github.io/posts/2021/12/redis_sds/>redis sds</a></li><li><a href=https://donnol.github.io/posts/2021/12/k8s/>k8s</a></li><li><a href=https://donnol.github.io/posts/2021/12/ddia/>数据密集型应用设计</a></li><li><a href=https://donnol.github.io/posts/2021/12/burn_cpu_use_golang/>burn cpu use golang</a></li><li><a href=https://donnol.github.io/posts/2021/12/docker_compose_extra_host/>docker compose使用extra host让容器访问主机服务</a></li><li><a href=https://donnol.github.io/posts/2021/12/dbeaver/>数据库管理工具之dbeaver</a></li><li><a href=https://donnol.github.io/posts/2021/12/domain/>Domain-oriented development</a></li><li><a href=https://donnol.github.io/posts/2021/12/github_action_deploy_hugo_blog/>github action deploy hugo blog</a></li></ul></li><li><input type=checkbox id=section-b59662e33ca9ad77b7d385cbee7785fe class=toggle>
<label for=section-b59662e33ca9ad77b7d385cbee7785fe class="flex justify-between"><a role=button>07</a></label><ul><li><a href=https://donnol.github.io/posts/2021/07/linux-epoll/>linux epoll</a></li></ul></li><li><input type=checkbox id=section-3b66512bb507cbdaa9cef9549f229fc1 class=toggle>
<label for=section-3b66512bb507cbdaa9cef9549f229fc1 class="flex justify-between"><a role=button>01</a></label><ul><li><a href=https://donnol.github.io/posts/2021/01/proxy-between-layer/>go实现AOP</a></li><li><a href=https://donnol.github.io/posts/2021/01/hugo-blog/>hugo搭建博客</a></li><li><a href=https://donnol.github.io/posts/2021/01/pstree/>pstree进程树及说明</a></li></ul></li></ul></li><li><input type=checkbox id=section-6f89cc6c76d5375fc02e3f7e596280b9 class=toggle>
<label for=section-6f89cc6c76d5375fc02e3f7e596280b9 class="flex justify-between"><a role=button>2020</a></label><ul><li><input type=checkbox id=section-03db05476b76e7f4afe06dfa3e1b675b class=toggle>
<label for=section-03db05476b76e7f4afe06dfa3e1b675b class="flex justify-between"><a role=button>12</a></label><ul><li><a href=https://donnol.github.io/posts/2020/12/go-ctx/>go ctx</a></li></ul></li></ul></li><li><a href=https://donnol.github.io/posts/aboutme/about-me/>关于我</a></li></ul><ul><li><a href=https://github.com/donnol/blog target=_blank rel=noopener>Github</a></li><li><a href=https://themes.gohugo.io/hugo-book/ target=_blank rel=noopener>Hugo Themes</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>智能合约</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#智能合约>智能合约</a><ul><li><a href=#安全问题>安全问题</a></li><li><a href=#合约开发测试和部署>合约开发、测试和部署</a></li><li><a href=#实战>实战</a></li></ul></li><li><a href=#evm>evm</a></li><li><a href=#wasm>wasm</a></li><li><a href=#solidity>solidity</a></li><li><a href=#nft>NFT</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1><a href=/posts/2022/01/smart_contract/>智能合约</a></h1><h5>January 26, 2022</h5><div><a href=/categories/blockchain/>blockchain</a>,
<a href=/categories/smart-contract/>smart contract</a></div><div><a href=/tags/eth/>eth</a>,
<a href=/tags/evm/>evm</a></div><h2 id=智能合约>智能合约
<a class=anchor href=#%e6%99%ba%e8%83%bd%e5%90%88%e7%ba%a6>#</a></h2><p><a href=https://zh.wikipedia.org/wiki/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6>智能合约wiki</a></p><blockquote><p>（英语：Smart contract）是一种特殊协议，在区块链内制定合约时使用，当中内含了代码函数 (Function)，亦能与其他合约进行交互、做决策、存储资料及发送以太币等功能。智能合约主要提供<strong>验证及执行合约内所订立的条件</strong>。智能合约允许在没有第三方的情况下进行可信交易。这些<strong>交易可追踪且不可逆转</strong>。</p></blockquote><h3 id=安全问题>安全问题
<a class=anchor href=#%e5%ae%89%e5%85%a8%e9%97%ae%e9%a2%98>#</a></h3><blockquote><p>智能合约是“执行合约条款的计算机交易协议”。区块链上的<strong>所有用户都可以看到</strong>基于区块链的智能合约。但是，这会导致包括安全漏洞在内的所有漏洞都可见，并且可能无法迅速修复。</p><p>这样的攻击难以迅速解决，例如：</p><blockquote><p>2016年6月The DAOEther的漏洞造成损失5000万美元，而开发者试图达成共识的解决方案。DAO的程序在黑客删除资金之前有一段时间的延迟。以太坊软件的一个硬分叉在时限到期之前完成了攻击者的资金回收工作。</p></blockquote><p>以太坊智能合约中的问题包括合约编程Solidity、编译器错误、以太坊虚拟机错误、对区块链网络的攻击、程序错误的不变性以及其他尚无文档记录的攻击。</p><blockquote><p>2018年4月22日， BeautyChain智能合约出现重大漏洞，黑客通过此漏洞无限生成代币，导致 BitEclipse (BEC)的价值接近归零。同月25日，SmartMesh出现疑似重大安全漏洞，宣布暂停所有SMT交易和转账直至另行通知，导致损失约1.4亿美金。28日，EOS被指可能存在BEC代币合约类似的整数溢出漏洞，但没消息详细说明。5月24日， BAI交易存在大量异常问题， 损失金额未知。8月22日， GODGAME 合约被黑客入侵，GOD智能合约上的以太坊总数归零。</p></blockquote></blockquote><h3 id=合约开发测试和部署>合约开发、测试和部署
<a class=anchor href=#%e5%90%88%e7%ba%a6%e5%bc%80%e5%8f%91%e6%b5%8b%e8%af%95%e5%92%8c%e9%83%a8%e7%bd%b2>#</a></h3><p><a href=https://ethereum.org/en/developers/docs/smart-contracts/>eth智能合约文档</a></p><p>vending machine(自动售货机): <code>money + snack selection = snack dispensed</code>, 给钱并选择小吃，小吃就会出来 &ndash; 是给刚好的钱，还是过量的钱，过量了在发放小吃的同时退钱呢？</p><p>合约长这样：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sol data-lang=sol><span style=display:flex><span><span style=color:#75715e>// 表明使用的sol版本 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>pragma solidity</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>8</span>.<span style=color:#ae81ff>7</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Solidity 合约类似于面向对象语言中的类。合约中有用于数据持久化的状态变量，和可以修改状态变量的函数。 调用另一个合约实例的函数时，会执行一个 EVM 函数调用，这个操作会切换执行时的上下文，这样，前一个合约的状态变量就不能访问了。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>contract</span> <span style=color:#a6e22e>VendingMachine</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Declare state variables of the contract
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>address</span> <span style=color:#66d9ef>public</span> owner; <span style=color:#75715e>// owner变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>mapping</span> (<span style=color:#66d9ef>address</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>uint</span>) <span style=color:#66d9ef>public</span> cupcakeBalances; <span style=color:#75715e>// cupcakeBalances变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建合约时，合约的构造函数会执行一次。构造函数是可选的。只允许有一个构造函数，这意味着不支持重载。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// When &#39;VendingMachine&#39; contract is deployed:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 1. set the deploying address as the owner of the contract
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 2. set the deployed smart contract&#39;s cupcake balance to 100
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>constructor</span>() {
</span></span><span style=display:flex><span>        owner <span style=color:#f92672>=</span> msg.sender; <span style=color:#75715e>// 设置部署本合约的地址为合约所有者
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// address(this)是将this转型为地址吗？
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// this不是代表合约对象吗，还能转为address？
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        cupcakeBalances[<span style=color:#66d9ef>address</span>(this)] <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>; <span style=color:#75715e>// 设置蛋糕余量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Allow the owner to increase the smart contract&#39;s cupcake balance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>refill</span>(<span style=color:#66d9ef>uint</span> amount) <span style=color:#66d9ef>public</span> { <span style=color:#75715e>// public表示方法可导出
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        require(msg.sender <span style=color:#f92672>==</span> owner, <span style=color:#e6db74>&#34;Only the owner can refill.&#34;</span>); <span style=color:#75715e>// 如果前面的条件不成立，则报错，后面为内容；此处要求消息的发送者必须是本合约所有者
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        cupcakeBalances[<span style=color:#66d9ef>address</span>(this)] <span style=color:#f92672>+=</span> amount; <span style=color:#75715e>// 补充蛋糕
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Allow anyone to purchase cupcakes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>purchase</span>(<span style=color:#66d9ef>uint</span> amount) <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>payable</span> { <span style=color:#75715e>// payable表示方法含有支付逻辑
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        require(msg.value <span style=color:#f92672>&gt;=</span> amount <span style=color:#f92672>*</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>ether</span>, <span style=color:#e6db74>&#34;You must pay at least 1 ETH per cupcake&#34;</span>); <span style=color:#75715e>// 此处要求每个蛋糕最少支付一个eth
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        require(cupcakeBalances[<span style=color:#66d9ef>address</span>(this)] <span style=color:#f92672>&gt;=</span> amount, <span style=color:#e6db74>&#34;Not enough cupcakes in stock to complete this purchase&#34;</span>); <span style=color:#75715e>// 此处要求蛋糕余量不小于需要的数量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        cupcakeBalances[<span style=color:#66d9ef>address</span>(this)] <span style=color:#f92672>-=</span> amount; <span style=color:#75715e>// 本合约所有者减少蛋糕
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        cupcakeBalances[msg.sender] <span style=color:#f92672>+=</span> amount; <span style=color:#75715e>// 消息发送者添加蛋糕
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><a href=https://ethereum.stackexchange.com/questions/40018/what-is-addressthis-in-solidity>address(this)</a></p><blockquote><p><strong>this</strong> refers to <strong>the instance of the contract where the call is made</strong> (you can have multiple instances of the same contract). &ndash; 调用发生时合约的实例</p><p><strong>address(this)</strong> refers to <strong>the address of the instance of the contract where the call is being made</strong>. &ndash; 调用发生的地方的合约的实例的地址</p><p><strong>msg.sender</strong> refers to <strong>the address where the contract is being called from</strong>.</p><p>Therefore, address(this) and msg.sender are two unique addresses, the first referring to <strong>the address of the contract instance</strong> and the second referring to <strong>the address where the contract call originated from</strong>.</p><blockquote><p>this: 实例;</p><p>address(this): 实例的地址;</p><p>msg.sender: 消息发送者，最初的合约调用者。</p></blockquote></blockquote><p>看上面的合约，<code>msg</code>是哪里来的，它里面有些什么东西呢？消息发送者买了蛋糕之后，还能再卖出去吗？</p><p><code>msg</code>是一个
<a href=https://medium.com/upstate-interactive/what-you-need-to-know-about-msg-global-variables-in-solidity-566f1e83cc69>全局变量</a></p><blockquote><p>For instance, <code>msg.sender</code> is always the address where the current (external) function call came from.</p><blockquote><p>For instance, if a function call came from a user or smart contract with the address 0xdfad6918408496be36eaf400ed886d93d8a6c180 then msg.sender equals 0xdfad6918408496be36eaf400ed886d93d8a6c180.</p></blockquote><p><code>msg.data</code> — The complete calldata which is a non-modifiable, non-persistent area where function arguments are stored and behave mostly like memory</p><p><code>msg.gas</code> — Returns the available gas remaining for a current transaction (you can learn more about gas in Ethereum here). The function <code>gasleft</code> was previously known as <code>msg.gas</code>, which was deprecated in version 0.4.21 and removed in version 0.5.0.</p><p><code>msg.sig</code> — The first four bytes of the calldata for a function that specifies the function to be called (i.e., it’s function identifier), 函数标识</p><p><code>msg.value</code> — The amount of wei sent with a message to a contract (wei is a denomination of ETH), 1 ETH = 10^18 wei</p></blockquote><p><a href="hhttps://docs.soliditylang.org/en/develop/units-and-global-variables.html?highlight=special%20variables%20and%20functions">更多全局变量和函数</a></p><blockquote><p>The special variables and functions are always available globally and are mainly used to provide information about the blockchain (i.e., transactions, contract info, address info, error handling, math and crypto functions).</p></blockquote><ul><li><p>Block and Transaction Properties</p></li><li><p>ABI Encoding and Decoding Functions</p></li><li><p>Members of bytes</p></li><li><p>Error Handling</p></li><li><p>Mathematical and Cryptographic Functions</p></li><li><p>Members of Address Types</p></li><li><p>Contract Related</p></li><li><p>Type Information</p></li></ul><p><a href=https://ethereum.org/en/developers/docs/smart-contracts/testing/>一些工具库</a></p><blockquote><p><a href=https://github.com/trufflesuite/truffle>truffle</a> - A tool for developing smart contracts. Crafted with the finest cacaos.</p><p><a href=https://github.com/EthWorks/Waffle>Waffle</a> - A framework for advanced smart contract development and testing (based on ethers.js).</p><p><a href=https://github.com/sc-forks/solidity-coverage>Solidity-Coverage</a> - Alternative solidity code coverage tool.</p><p><a href=https://github.com/dapphub/dapptools/tree/master/src/hevm>hevm</a> - Implementation of the EVM made specifically for unit testing and debugging smart contracts.</p><p><a href=https://github.com/whiteblock/genesis>Whiteblock Genesis</a> - An end-to-end development sandbox and testing platform for blockchain.</p><p><a href=https://github.com/OpenZeppelin/openzeppelin-test-environment>OpenZeppelin Test Environment</a>(已归档) - Blazing fast smart contract testing. One-line setup for an awesome testing experience.</p><p><a href=https://github.com/OpenZeppelin/openzeppelin-test-helpers>OpenZeppelin Test Helpers</a> - Assertion library for Ethereum smart contract testing. Make sure your contracts behave as expected!</p></blockquote><h3 id=实战>实战
<a class=anchor href=#%e5%ae%9e%e6%88%98>#</a></h3><p>安装
<a href=https://metamask.io/download/><code>ETH钱包MetaMask(firefox插件)</code></a></p><p>新建账户，会提示输入密码，然后生成成功后，会有一堆助记词，需要记录好：</p><pre tabindex=0><code>jeans term salt true cereal hobby cheese awesome link nice never choose
</code></pre><p>钱包默认连接的是主网，因为主网要花钱买币，所以我们选择测试网。在主网那里点击设置打开<code>Show test networks</code>配置。</p><p>获得地址：<code>0x758c40f09207f9e6F72A8C24029Be865D28eF219</code></p><p><a href=https://faucet.rinkeby.io/>eth rinkeby测试网水龙头</a></p><p>为上述地址去水龙头领取币。</p><p>需要先把上述地址发到推特、脸书、谷家任一地方，然后再使用对应帖子的地址(如：)来获取。</p><p>如果报错<code>nsufficient funds for gas * price + value</code>，可尝试使用
<a href=https://faucets.chain.link/rinkeby>另外的网站</a>直接使用地址获取。</p><p>拿到之后，在<code>metamask</code>查看余额。</p><p><a href=https://rinkeby.etherscan.io/>eth rinkeby测试网浏览器</a></p><p>在浏览器上可以查找到上述的
<a href=https://rinkeby.etherscan.io/address/0x758c40f09207f9e6F72A8C24029Be865D28eF219>转账记录</a></p><p><a href=https://github.com/upstateinteractive/blockchain-puzzle>参照这个游戏示例</a></p><p><a href=http://remix.ethereum.org/>编译、部署合约</a></p><p>TODO:</p><h2 id=evm>evm
<a class=anchor href=#evm>#</a></h2><p><a href=github.com/ethereum/go-ethereum/core/vm>代码</a></p><ul><li><p>stack based</p></li><li><p>register based</p></li></ul><h2 id=wasm>wasm
<a class=anchor href=#wasm>#</a></h2><p><a href=https://medium.com/chainsafe-systems/ethereum-2-0-a-complete-guide-ewasm-394cac756baf>切换到ewasm的背景和好处</a></p><p><a href=https://github.com/webassembly/wabt>wasm工具集</a></p><h2 id=solidity>solidity
<a class=anchor href=#solidity>#</a></h2><p><a href=https://learnblockchain.cn/docs/solidity/contracts.html>contract</a></p><h2 id=nft>NFT
<a class=anchor href=#nft>#</a></h2><p><a href=https://zh.wikipedia.org/wiki/%E9%9D%9E%E5%90%8C%E8%B3%AA%E5%8C%96%E4%BB%A3%E5%B9%A3>NFT wiki</a></p><blockquote><p>非同质化代币（英语：Non-Fungible Token，简称：NFT），是一种被称为区块链数字账本上的数据单位，<strong>每个代币可以代表一个独特的数字资料</strong>，作为虚拟商品所有权的电子认证或证书。由于其不能互换，非同质化代币可以代表数字文件，如画作、声音、视频、游戏中的项目或其他形式的创意作品。<strong>虽然文件（作品）本身是可以无限复制的，但代表它们的代币在其底层区块链上被追踪，并为买家提供所有权证明</strong>。诸如以太币、比特币等加密货币都有自己的代币标准以定义对NFT的使用。</p><p>非同质化代币一种存储在区块链（数位账本）上的数据单位，它可以<strong>代表艺术品等独一无二的数字物品</strong>。其是一种加密代币，但与比特币等加密货币不同，其<strong>不可互换</strong>。一个非同质化代币是透过上传一个文件，如艺术品，到非同质化代币拍卖市场。<strong>这将创建一个记录在数字账本上的文件副本作为非同质化代币，它可以用加密货币购买和转售</strong>。虽然艺术家可以出售代表作品的非同质化代币，但<strong>艺术家仍然可以保留作品的著作权，并创造更多的同一作品的非同质化代币</strong>。非同质化代币的<strong>买家并不能获得对作品的独家访问权</strong>，买家也不能获得对原始数字文件的独占。将某一作品作为非同质化代币上传的人不必证明他们是原创艺术家，在许多争议案例中，在未经创作者许可的情况下，艺术品被盗用于非同质化代币。</p></blockquote><p><a href=https://ethereum.org/zh/nft/>eth nft</a></p><ul><li>一种将任何独特物品表现为以太坊资产的方式。</li><li>NFT 为内容创建人赋予了比以往更多的权力。</li><li>由以太坊区块链上的智能合约提供支持。</li></ul><blockquote><p>NFT 是我们用以代表独特物品所有权的代币。 NFT 让我们把诸如艺术品、收藏品、甚至房地产等物品代币化。 <strong>他们一次只有一个正式主人，并且受到以太坊区块链的保护</strong> - 没有人可以修改所有权记录或者根据现有的 NFT 复制粘贴一份新的。</p><blockquote><p>NFT 代表非同质化代币。非同质化是一个经济术语，您可以用它来描述家具、歌曲文件或您的电脑等物品。<strong>这些东西不能与其他物品互换，因为它们具有独特属性</strong>。</p><p>另一方面，<strong>同质化物品可以互换，这取决于它们的价值而非独特属性</strong>。 例如，ETH 或美元具有同质化属性，因为 1 ETH/1 USD 可以兑换成另外的 1 ETH/1 USD。</p></blockquote></blockquote><p>当他们(数字产品作者)出售内容时，资金直接转给他们。如果新所有者随后出售 NFT，原创建人(数字产品作者)甚至可以自动收到版税。这在每次出售时都有保证，因为创建人的地址是代币元数据的一部分 - 元数据无法修改。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//donno272.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#智能合约>智能合约</a><ul><li><a href=#安全问题>安全问题</a></li><li><a href=#合约开发测试和部署>合约开发、测试和部署</a></li><li><a href=#实战>实战</a></li></ul></li><li><a href=#evm>evm</a></li><li><a href=#wasm>wasm</a></li><li><a href=#solidity>solidity</a></li><li><a href=#nft>NFT</a></li></ul></li></ul></nav></div></aside></main></body></html>