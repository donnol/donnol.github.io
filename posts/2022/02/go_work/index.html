<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="go1.18将要推出workspace模式，此举是为了方便在本地开发多个不同module时的依赖管理。
命令说明：
$ go help work Go workspace provides access to operations on workspaces.  Note that support for workspaces is built into many other commands, not just 'go work'.  See 'go help modules' for information about Go\'s module system of which workspaces are a part.  A workspace is specified by a go.work file that specifies a set of module directories with the &#34;use&#34; directive. These modules are used as root modules by the go command for builds and related operations."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="go work"><meta property="og:description" content="go1.18将要推出workspace模式，此举是为了方便在本地开发多个不同module时的依赖管理。
命令说明：
$ go help work Go workspace provides access to operations on workspaces.  Note that support for workspaces is built into many other commands, not just 'go work'.  See 'go help modules' for information about Go\'s module system of which workspaces are a part.  A workspace is specified by a go.work file that specifies a set of module directories with the &#34;use&#34; directive. These modules are used as root modules by the go command for builds and related operations."><meta property="og:type" content="article"><meta property="og:url" content="https://donnol.github.io/posts/2022/02/go_work/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-10T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-10T00:00:00+00:00"><title>go work | 我的简单博客</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.09a284f5a03730d86dde350d2c062b1514e48fdfebba7763941c0674ef65748f.css integrity="sha256-CaKE9aA3MNht3jUNLAYrFRTkj9/rundjlBwGdO9ldI8=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.e8b0d2a1f6e32881a8a71c1dfa1ce9f4ed9fd7bb604d6a44f14711ef84664af8.js integrity="sha256-6LDSofbjKIGopxwd+hzp9O2f17tgTWpE8UcR74RmSvg=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>我的简单博客</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-c8e9ae7896ddc3e931652e7edbcbefe2 class=toggle checked>
<label for=section-c8e9ae7896ddc3e931652e7edbcbefe2 class="flex justify-between"><a role=button>2022</a></label><ul><li><input type=checkbox id=section-821dedbe2a29b27962c9696b13382042 class=toggle>
<label for=section-821dedbe2a29b27962c9696b13382042 class="flex justify-between"><a role=button>03</a></label><ul><li><a href=https://donnol.github.io/posts/2022/03/kmp/>KMP</a></li></ul></li><li><input type=checkbox id=section-935ca4c1d23ab780a0809b4bc7c413bf class=toggle checked>
<label for=section-935ca4c1d23ab780a0809b4bc7c413bf class="flex justify-between"><a role=button>02</a></label><ul><li><a href=https://donnol.github.io/posts/2022/02/%E9%9C%9C%E4%B9%8B%E5%93%80%E4%BC%A4/>霜之哀伤</a></li><li><a href=https://donnol.github.io/posts/2022/02/goroutine_vs_tokio/>goroutine vs tokio</a></li><li><a href=https://donnol.github.io/posts/2022/02/go_runtime_chan/>go runtime chan</a></li><li><a href=https://donnol.github.io/posts/2022/02/go_work/ class=active>go work</a></li><li><a href=https://donnol.github.io/posts/2022/02/distractions/>杂念</a></li></ul></li><li><input type=checkbox id=section-a7c5705090b10b47e082065e722e7e5c class=toggle>
<label for=section-a7c5705090b10b47e082065e722e7e5c class="flex justify-between"><a role=button>01</a></label><ul><li><a href=https://donnol.github.io/posts/2022/01/rust_safe/>Rust与安全</a></li><li><a href=https://donnol.github.io/posts/2022/01/wasmtime/>wasm运行时wasmtime</a></li><li><a href=https://donnol.github.io/posts/2022/01/container_encrypt/>容器镜像加密</a></li><li><a href=https://donnol.github.io/posts/2022/01/smart_contract/>智能合约</a></li><li><a href=https://donnol.github.io/posts/2022/01/learn_go_fast/>Go快速入门</a></li><li><a href=https://donnol.github.io/posts/2022/01/consensus/>consensus</a></li><li><a href=https://donnol.github.io/posts/2022/01/red_black_tree/>红黑树</a></li><li><a href=https://donnol.github.io/posts/2022/01/rust_commonly_used_crate/>Rust常用库</a></li><li><a href=https://donnol.github.io/posts/2022/01/cache/>缓存和数据库如何保持一致</a></li></ul></li><li><input type=checkbox id=section-98bace91040a47ec7d7a95076963fc62 class=toggle>
<label for=section-98bace91040a47ec7d7a95076963fc62 class="flex justify-between"><a role=button>04</a></label><ul><li><a href=https://donnol.github.io/posts/2022/04/go1.18_comparable/>Go1.18 Comparable</a></li></ul></li><li><input type=checkbox id=section-d9a952ec7a0fcb7a9ba717dc9bfce17b class=toggle>
<label for=section-d9a952ec7a0fcb7a9ba717dc9bfce17b class="flex justify-between"><a role=button>05</a></label><ul><li><a href=https://donnol.github.io/posts/2022/05/go_enum/>Go Enum</a></li><li><a href=https://donnol.github.io/posts/2022/05/k8s_how_to_keep_pods/>K8s How to Keep Pods</a></li></ul></li></ul></li><li><input type=checkbox id=section-71121fe02c394c786aa5fdaffc9e5412 class=toggle>
<label for=section-71121fe02c394c786aa5fdaffc9e5412 class="flex justify-between"><a role=button>2021</a></label><ul><li><input type=checkbox id=section-393d931b698132759df1a7089df0fcc8 class=toggle>
<label for=section-393d931b698132759df1a7089df0fcc8 class="flex justify-between"><a role=button>12</a></label><ul><li><a href=https://donnol.github.io/posts/2021/12/ebpf/>ebpf</a></li><li><a href=https://donnol.github.io/posts/2021/12/time_wenzi/>时间和文字</a></li><li><a href=https://donnol.github.io/posts/2021/12/etcd/>etcd</a></li><li><a href=https://donnol.github.io/posts/2021/12/vscode-go-module/>vscode-go在go.mod在非根目录情况下失效的问题</a></li><li><a href=https://donnol.github.io/posts/2021/12/mqtt/>mqtt</a></li><li><a href=https://donnol.github.io/posts/2021/12/redis_sds/>redis sds</a></li><li><a href=https://donnol.github.io/posts/2021/12/k8s/>k8s</a></li><li><a href=https://donnol.github.io/posts/2021/12/ddia/>数据密集型应用设计</a></li><li><a href=https://donnol.github.io/posts/2021/12/burn_cpu_use_golang/>burn cpu use golang</a></li><li><a href=https://donnol.github.io/posts/2021/12/docker_compose_extra_host/>docker compose使用extra host让容器访问主机服务</a></li><li><a href=https://donnol.github.io/posts/2021/12/dbeaver/>数据库管理工具之dbeaver</a></li><li><a href=https://donnol.github.io/posts/2021/12/domain/>Domain-oriented development</a></li><li><a href=https://donnol.github.io/posts/2021/12/github_action_deploy_hugo_blog/>github action deploy hugo blog</a></li></ul></li><li><input type=checkbox id=section-b59662e33ca9ad77b7d385cbee7785fe class=toggle>
<label for=section-b59662e33ca9ad77b7d385cbee7785fe class="flex justify-between"><a role=button>07</a></label><ul><li><a href=https://donnol.github.io/posts/2021/07/linux-epoll/>linux epoll</a></li></ul></li><li><input type=checkbox id=section-3b66512bb507cbdaa9cef9549f229fc1 class=toggle>
<label for=section-3b66512bb507cbdaa9cef9549f229fc1 class="flex justify-between"><a role=button>01</a></label><ul><li><a href=https://donnol.github.io/posts/2021/01/proxy-between-layer/>Go实现AOP</a></li><li><a href=https://donnol.github.io/posts/2021/01/hugo-blog/>hugo搭建博客</a></li><li><a href=https://donnol.github.io/posts/2021/01/pstree/>pstree进程树及说明</a></li></ul></li></ul></li><li><input type=checkbox id=section-6f89cc6c76d5375fc02e3f7e596280b9 class=toggle>
<label for=section-6f89cc6c76d5375fc02e3f7e596280b9 class="flex justify-between"><a role=button>2020</a></label><ul><li><input type=checkbox id=section-03db05476b76e7f4afe06dfa3e1b675b class=toggle>
<label for=section-03db05476b76e7f4afe06dfa3e1b675b class="flex justify-between"><a role=button>12</a></label><ul><li><a href=https://donnol.github.io/posts/2020/12/go-ctx/>go ctx</a></li></ul></li></ul></li><li><a href=https://donnol.github.io/posts/aboutme/about-me/>关于我</a></li></ul><ul><li><a href=https://github.com/donnol/blog target=_blank rel=noopener>Github</a></li><li><a href=https://themes.gohugo.io/hugo-book/ target=_blank rel=noopener>Hugo Themes</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>go work</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class=markdown><h1><a href=/posts/2022/02/go_work/>go work</a></h1><h5>February 10, 2022</h5><div><a href=/categories/go/>go</a>,
<a href=/categories/work/>work</a></div><div><a href=/tags/workspace/>workspace</a></div><p>go1.18将要推出<code>workspace</code>模式，此举是为了方便在本地开发多个不同<code>module</code>时的依赖管理。</p><p>命令说明：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ go help work
</span></span><span style=display:flex><span>Go workspace provides access to operations on workspaces.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Note that support <span style=color:#66d9ef>for</span> workspaces is built into many other commands, not
</span></span><span style=display:flex><span>just <span style=color:#e6db74>&#39;go work&#39;</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>See <span style=color:#e6db74>&#39;go help modules&#39;</span> <span style=color:#66d9ef>for</span> information about Go<span style=color:#ae81ff>\&#39;</span>s module system of which
</span></span><span style=display:flex><span>workspaces are a part.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>A workspace is specified by a go.work file that specifies a set of
</span></span><span style=display:flex><span>module directories with the <span style=color:#e6db74>&#34;use&#34;</span> directive. These modules are used as
</span></span><span style=display:flex><span>root modules by the go command <span style=color:#66d9ef>for</span> builds and related operations.  A
</span></span><span style=display:flex><span>workspace that does not specify modules to be used cannot be used to <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>builds from local modules.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go.work files are line-oriented. Each line holds a single directive,
</span></span><span style=display:flex><span>made up of a keyword followed by arguments. For example:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        go 1.18
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        use ../foo/bar
</span></span><span style=display:flex><span>        use ./baz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        replace example.com/foo v1.2.3 <span style=color:#f92672>=</span>&gt; example.com/bar v1.4.5
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The leading keyword can be factored out of adjacent lines to create a block,
</span></span><span style=display:flex><span>like in Go imports.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        use <span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>          ../foo/bar
</span></span><span style=display:flex><span>          ./baz
</span></span><span style=display:flex><span>        <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The use directive specifies a module to be included in the workspace<span style=color:#ae81ff>\&#39;</span>s
</span></span><span style=display:flex><span>set of main modules. The argument to the use directive is the directory
</span></span><span style=display:flex><span>containing the module<span style=color:#ae81ff>\&#39;</span>s go.mod file.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The go directive specifies the version of Go the file was written at. It
</span></span><span style=display:flex><span>is possible there may be future changes in the semantics of workspaces
</span></span><span style=display:flex><span>that could be controlled by this version, but <span style=color:#66d9ef>for</span> now the version
</span></span><span style=display:flex><span>specified has no effect.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The replace directive has the same syntax as the replace directive in a
</span></span><span style=display:flex><span>go.mod file and takes precedence over replaces in go.mod files.  It is
</span></span><span style=display:flex><span>primarily intended to override conflicting replaces in different workspace
</span></span><span style=display:flex><span>modules.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To determine whether the go command is operating in workspace mode, use
</span></span><span style=display:flex><span>the <span style=color:#e6db74>&#34;go env GOWORK&#34;</span> command. This will specify the workspace file being
</span></span><span style=display:flex><span>used.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        go work &lt;command&gt; <span style=color:#f92672>[</span>arguments<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The commands are:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        edit        edit go.work from tools or scripts
</span></span><span style=display:flex><span>        init        initialize workspace file
</span></span><span style=display:flex><span>        sync        sync workspace build list to modules
</span></span><span style=display:flex><span>        use         add modules to workspace file
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Use <span style=color:#e6db74>&#34;go help work &lt;command&gt;&#34;</span> <span style=color:#66d9ef>for</span> more information about a command.
</span></span></code></pre></div><p>使用<code>use</code>指令指定包含在<code>workspace</code>里的<code>module</code>集。<code>use</code>指令后紧接着的是包含了模块的<code>go.mod</code>文件的目录&ndash;相对<code>go.work</code>的目录。</p><p><code>use</code>指定的模块被<code>go</code>命令用作根模块，执行构建等操作。</p><p><code>replace</code>指令与<code>go.mod</code>里的用法一样。它会覆盖在<code>workspace</code>里不同的模块之间的冲突<code>replace</code>。</p><p>比如，分别有模块<code>bar</code>, <code>baz</code>:</p><p>它们的<code>go.mod</code>分别是：</p><pre tabindex=0><code class=language-gomod data-lang=gomod>go 1.18

replace foo v0.0.1 =&gt; ./foo
</code></pre><pre tabindex=0><code class=language-gomod data-lang=gomod>go 1.18

replace foo v0.0.1 =&gt; foo v0.0.2
</code></pre><p>可以看到，它们<code>replace</code>了不同的<code>foo</code>。</p><pre tabindex=0><code class=language-gowork data-lang=gowork>go 1.18

use (
    ./bar
    ./baz
)

replace foo v0.0.1 =&gt; ../foo
</code></pre><p>在<code>go.work</code>里统一了对于<code>foo</code>的<code>replace</code>，均指向到了<code>../foo</code>。</p><p>不过，虽然多了这个<code>workspace</code>模式，依然无法解决<code>module</code>版本依赖问题&ndash;模块路径和模块版本问题。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents></nav></div></aside></main></body></html>